<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="summary"><title>萌芽杯项目的python代码 | Yun.Qi</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.png"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">萌芽杯项目的python代码</h1><a id="logo" href="/.">Yun.Qi</a><p class="summary">Note/Diary</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">萌芽杯项目的python代码</h1><div class="post-meta">2020-02-19<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF%E5%8A%9B/">技术力</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4,915</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 27</span><span class="post-meta-item-text"> Minutes</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-测试"><span class="toc-text">1. 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-视频经过梯度处理"><span class="toc-text">1.1 视频经过梯度处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-检测指针，绘制直线"><span class="toc-text">1.2 检测指针，绘制直线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-小综合；根据表盘识别指针并求出斜率"><span class="toc-text">1.3 小综合；根据表盘识别指针并求出斜率</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-更高级的检测指针，然后返回指针斜率"><span class="toc-text">1.4 更高级的检测指针，然后返回指针斜率</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-初步完成核心"><span class="toc-text">2. 初步完成核心</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-进一步优化，直接再存到-excel-同时绘制图线，达到粗略得实时"><span class="toc-text">3. 进一步优化，直接再存到 excel 同时绘制图线，达到粗略得实时</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-粗糙的整合–待优化"><span class="toc-text">4. 粗糙的整合–待优化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-进一步优化"><span class="toc-text">5. 进一步优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-分析误差的准备"><span class="toc-text">5.1 分析误差的准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-构造一个桌面指针"><span class="toc-text">5.1.1 构造一个桌面指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-手机上下载一个模拟时钟"><span class="toc-text">5.1.2 手机上下载一个模拟时钟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-获取两者数据对比来分析误差"><span class="toc-text">5.1.3 获取两者数据对比来分析误差</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><a id="more"></a>

<h1 id="1-测试"><a href="#1-测试" class="headerlink" title="1. 测试"></a>1. 测试</h1><h2 id="1-1-视频经过梯度处理"><a href="#1-1-视频经过梯度处理" class="headerlink" title="1.1 视频经过梯度处理"></a>1.1 视频经过梯度处理</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">vc = cv2.VideoCapture(<span class="string">'./video/1.mp4'</span>)</span><br><span class="line"><span class="keyword">if</span> vc.isOpened():</span><br><span class="line">    open, frame = vc.read()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    open = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> open:</span><br><span class="line">    ret, frame = vc.read()</span><br><span class="line">    <span class="keyword">if</span> frame <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="literal">True</span>:</span><br><span class="line">        gray = cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY)</span><br><span class="line">        <span class="comment"># sobelx = cv2.Sobel(gray,cv2.CV_64F,1,0)</span></span><br><span class="line">        <span class="comment"># sobely = cv2.Sobel(gray,cv2.CV_64F,0,1)</span></span><br><span class="line">        <span class="comment"># sobelx = cv2.convertScaleAbs(sobelx)</span></span><br><span class="line">        <span class="comment"># sobely = cv2.convertScaleAbs(sobely)</span></span><br><span class="line">        <span class="comment"># sobelxy = cv2.addWeighted(sobelx,0.5,sobely,0.5,0)</span></span><br><span class="line">        v1 = cv2.Canny(gray,<span class="number">10</span>,<span class="number">50</span>)</span><br><span class="line">        cv2.namedWindow(<span class="string">'result'</span>,<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># cv2.imshow('result',sobelxy)</span></span><br><span class="line">        cv2.imshow(<span class="string">'result'</span>,v1)</span><br><span class="line">        <span class="keyword">if</span> cv2.waitKey(<span class="number">10</span>) &amp; <span class="number">0xFF</span> == <span class="number">27</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">vc.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></tbody></table></figure>

<h2 id="1-2-检测指针，绘制直线"><a href="#1-2-检测指针，绘制直线" class="headerlink" title="1.2 检测指针，绘制直线"></a>1.2 检测指针，绘制直线</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">'./img/clock2.jpg'</span>)    <span class="comment"># + input('请输入文件路径：')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv_show</span><span class="params">(name,img)</span>:</span></span><br><span class="line">    cv2.namedWindow(name,<span class="number">0</span>)</span><br><span class="line">    cv2.imshow(name,img)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linedraw</span><span class="params">(image)</span>:</span></span><br><span class="line">    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span><br><span class="line">        <span class="comment"># edges = cv.Canny(gray, 50, 150, apertureSize=3)</span></span><br><span class="line">        <span class="comment"># 自动检测可能的直线，返回的是一条条线段</span></span><br><span class="line">    ret, thresohold = cv2.threshold(gray, <span class="number">55</span>, <span class="number">255</span>, cv2.THRESH_BINARY)</span><br><span class="line">    <span class="comment"># aussian = cv2.GaussianBlur(thresohold, (5, 5), 1) 高斯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># kernel = np.ones((5, 5), np.uint8)  # （5，5）腐蚀大小</span></span><br><span class="line">    <span class="comment"># erosion = cv2.erode(thresohold, kernel, iterations=1) 去噪音点</span></span><br><span class="line"></span><br><span class="line">    edges = cv2.Canny(thresohold, <span class="number">10</span>, <span class="number">150</span>, apertureSize=<span class="number">3</span>)</span><br><span class="line">    lines = cv2.HoughLinesP(edges, <span class="number">1</span>, np.pi / <span class="number">180</span>, <span class="number">80</span>, minLineLength=<span class="number">110</span>, maxLineGap=<span class="number">10</span>)</span><br><span class="line">        <span class="comment"># print(type(lines))</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        x1, y1, x2, y2 = line[<span class="number">0</span>]</span><br><span class="line">        cv2.line(image, (x1, y1), (x2, y2), (<span class="number">0</span>, <span class="number">255</span>,<span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">    cv_show(<span class="string">'result'</span>,image)</span><br><span class="line"></span><br><span class="line">linedraw(img)</span><br><span class="line">os.system(<span class="string">"pause"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="1-3-小综合；根据表盘识别指针并求出斜率"><a href="#1-3-小综合；根据表盘识别指针并求出斜率" class="headerlink" title="1.3 小综合；根据表盘识别指针并求出斜率"></a>1.3 小综合；根据表盘识别指针并求出斜率</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">'./img/clock1.jpg'</span>, cv2.IMREAD_UNCHANGED)</span><br><span class="line"><span class="comment"># 裁剪图片  具体指针要改</span></span><br><span class="line">imgbufen = img[<span class="number">70</span>:<span class="number">566</span>,<span class="number">0</span>:<span class="number">1000</span>]</span><br><span class="line"><span class="comment"># 将图像的阈值化 小于阈值的为max 大于阈值的为0，</span></span><br><span class="line"><span class="comment"># 主要是因为这个指针是黑的,圆形遮罩也是黑的，所以先把指针反转为白的</span></span><br><span class="line"><span class="comment"># 具体指针要改</span></span><br><span class="line">imgfan = cv2.threshold(imgbufen,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_BINARY_INV)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出图像</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv_show</span><span class="params">(name,img)</span>:</span></span><br><span class="line">    cv2.namedWindow(name,<span class="number">0</span>)</span><br><span class="line">    cv2.imshow(name,img)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到一个圆形遮罩，返回中间圆形</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_zhezhao</span><span class="params">(imgfan)</span>:</span></span><br><span class="line">    <span class="comment">#获取图片尺寸</span></span><br><span class="line">    height, width = imgfan.shape[:<span class="number">2</span>]</span><br><span class="line">    height = int(height)</span><br><span class="line">    width = int(width)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#生成内显示模板</span></span><br><span class="line">    circleIn = np.zeros((height, width, <span class="number">1</span>), np.uint8)</span><br><span class="line">    circleIn = cv2.circle(circleIn, (width // <span class="number">2</span>, height // <span class="number">2</span>), min(height, width) // <span class="number">2</span>, (<span class="number">1</span>), <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#原图与内显示模板融合</span></span><br><span class="line">    <span class="comment">#生成空白图片</span></span><br><span class="line">    imgIn = np.zeros((height, width, <span class="number">4</span>), np.uint8)</span><br><span class="line">    <span class="comment">#复制前3个通道</span></span><br><span class="line">    imgIn[:, :, <span class="number">0</span>] = np.multiply(imgfan[:, :, <span class="number">0</span>], circleIn[:, :, <span class="number">0</span>])</span><br><span class="line">    imgIn[:, :, <span class="number">1</span>] = np.multiply(imgfan[:, :, <span class="number">1</span>], circleIn[:, :, <span class="number">0</span>])</span><br><span class="line">    imgIn[:, :, <span class="number">2</span>] = np.multiply(imgfan[:, :, <span class="number">2</span>], circleIn[:, :, <span class="number">0</span>])</span><br><span class="line">    <span class="comment">#设置α通道的不透明部分</span></span><br><span class="line">    circleIn[circleIn == <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    imgIn[:, :, <span class="number">3</span>] = circleIn[:, :, <span class="number">0</span>]</span><br><span class="line">    <span class="comment"># cv2.imwrite('./img/result1.jpg', imgIn)</span></span><br><span class="line">    <span class="comment"># cv_show('imgin',imgIn)</span></span><br><span class="line">    <span class="keyword">return</span> imgIn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到线，霍夫直线</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getlines</span><span class="params">(imgIn)</span>:</span></span><br><span class="line">    gray = cv2.cvtColor(imgIn,cv2.COLOR_BGR2GRAY)</span><br><span class="line">    <span class="comment"># cv_show("gray",gray)</span></span><br><span class="line">    edges = cv2.Canny(gray, <span class="number">10</span>, <span class="number">150</span>, apertureSize=<span class="number">3</span>)</span><br><span class="line">    lines = cv2.HoughLinesP(edges, <span class="number">1</span>, np.pi / <span class="number">180</span>, <span class="number">80</span>, minLineLength=<span class="number">110</span>, maxLineGap=<span class="number">10</span>)</span><br><span class="line">            <span class="comment"># print(type(lines))</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        x1, y1, x2, y2 = line[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># print(x1,y1,x2,y2)</span></span><br><span class="line">        cv2.line(imgbufen, (x1, y1), (x2, y2), (<span class="number">0</span>, <span class="number">255</span>,<span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># cv_show('img',imgbufen)</span></span><br><span class="line">        floatx1.append(float(x1))</span><br><span class="line">        floaty1.append(float(y1))</span><br><span class="line">        floatx2.append(float(x2))</span><br><span class="line">        floaty2.append(float(y2))</span><br><span class="line">    <span class="comment"># cv_show('imgline',imgbufen)</span></span><br><span class="line">    <span class="keyword">return</span> floatx1,floaty1,floatx2,floaty2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_thr_k</span><span class="params">()</span>:</span></span><br><span class="line">    thrs = []</span><br><span class="line">    ks = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(floatx1)):</span><br><span class="line">        x1 = floatx1[i]</span><br><span class="line">        y1 = floaty1[i]</span><br><span class="line">        x2 = floatx2[i]</span><br><span class="line">        y2 = floaty2[i]</span><br><span class="line">        k = (y1-y2)/(x2-x1)</span><br><span class="line">        thr = math.atan(k)</span><br><span class="line">        thr = math.degrees(thr)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        ks.append(k)</span><br><span class="line">        thrs.append(thr)</span><br><span class="line">    <span class="keyword">return</span> ks,thrs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">imgIn = get_zhezhao(imgfan)</span><br><span class="line">floatx1,floaty1,floatx2,floaty2 = [],[],[],[]</span><br><span class="line">getlines(imgIn)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(floatx1,floaty1,floatx2,floaty2)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多条直线的角度列表，单条直线直接thrs[0]</span></span><br><span class="line">thrs = get_thr_k()</span><br><span class="line">print(<span class="string">f'直线的斜率为：<span class="subst">{thrs[<span class="number">0</span>][<span class="number">0</span>]}</span>'</span>)</span><br><span class="line">print(<span class="string">f'直线与横线间角度值：<span class="subst">{thrs[<span class="number">1</span>][<span class="number">0</span>]}</span>'</span>)</span><br><span class="line">cv_show(<span class="string">'imgline'</span>,imgbufen)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="1-4-更高级的检测指针，然后返回指针斜率"><a href="#1-4-更高级的检测指针，然后返回指针斜率" class="headerlink" title="1.4 更高级的检测指针，然后返回指针斜率"></a>1.4 更高级的检测指针，然后返回指针斜率</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> linekthr <span class="keyword">as</span> lt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pointer_rad</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="string">'''获取角度'''</span></span><br><span class="line">    shape = img.shape</span><br><span class="line">    c_y, c_x, depth = int(shape[<span class="number">0</span>] / <span class="number">2</span>), int(shape[<span class="number">1</span>] / <span class="number">2</span>), shape[<span class="number">2</span>]    <span class="comment"># h,w,cute</span></span><br><span class="line">    x1=c_x+c_x*<span class="number">1.5</span>  <span class="comment"># 指针长度--宽 2.5倍</span></span><br><span class="line">    src = img.copy()</span><br><span class="line">    freq_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">361</span>):        <span class="comment"># 算法</span></span><br><span class="line">        x = (x1 - c_x) * math.cos(i * math.pi / <span class="number">180</span>) + c_x</span><br><span class="line">        y = (x1 - c_x) * math.sin(i * math.pi / <span class="number">180</span>) + c_y</span><br><span class="line">        temp = src.copy()   <span class="comment"># 备份</span></span><br><span class="line">        cv2.line(temp, (c_x, c_y), (int(x), int(y)), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), thickness=<span class="number">1</span>)  <span class="comment"># 在temp上画线</span></span><br><span class="line">        t1 = img.copy()</span><br><span class="line">        t1[temp[:, :, <span class="number">1</span>] == <span class="number">255</span>] = <span class="number">255</span></span><br><span class="line">        c = img[temp[:, :, <span class="number">1</span>] == <span class="number">255</span>]</span><br><span class="line">        points = c[c == <span class="number">0</span>]</span><br><span class="line">        freq_list.append((len(points), i))</span><br><span class="line">        cv2.imshow(<span class="string">'d'</span>, temp)</span><br><span class="line">        <span class="comment"># cv2.imshow('d1', t1)</span></span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># key = lambda x: float(x[0])</span></span><br><span class="line">    <span class="comment"># keytup = max(freq_list, key=key)</span></span><br><span class="line">    <span class="comment"># thrth = keytup[1]</span></span><br><span class="line">    <span class="comment"># print(f'当前角度:{thrth}度')</span></span><br><span class="line">    <span class="comment"># print('当前角度：',max(freq_list, key=key),'度')</span></span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line">    <span class="keyword">return</span> max(freq_list, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">'./img/clock_re.png'</span>)</span><br><span class="line">imgc = img[<span class="number">0</span>:<span class="number">165</span>,<span class="number">6</span>:<span class="number">171</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getthr</span><span class="params">()</span>:</span></span><br><span class="line">    thres = np.random.randint(<span class="number">40</span>,<span class="number">100</span>)   <span class="comment"># 随机数范围</span></span><br><span class="line">    <span class="comment"># print(thres)</span></span><br><span class="line">    imgfan = cv2.threshold(imgc, thres, <span class="number">255</span>, cv2.THRESH_BINARY)[<span class="number">1</span>]</span><br><span class="line">    max = get_pointer_rad(imgfan)</span><br><span class="line">    <span class="comment"># lt.cv_show('imgfan',imgfan)</span></span><br><span class="line">    <span class="comment"># print(max)</span></span><br><span class="line">    <span class="comment"># exit()</span></span><br><span class="line">    thrs = []</span><br><span class="line">    thr = max[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> thr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_averg</span><span class="params">()</span>:</span></span><br><span class="line">    tol = <span class="number">0</span></span><br><span class="line">    h = <span class="number">20</span>          <span class="comment"># 统计次数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(h):</span><br><span class="line">        thr = getthr()</span><br><span class="line">        tol = tol + thr</span><br><span class="line">        print(<span class="string">f'第<span class="subst">{i+<span class="number">1</span>}</span>次的角度:<span class="subst">{thr}</span>'</span>)</span><br><span class="line">    averg = tol / h</span><br><span class="line">    <span class="keyword">return</span> averg</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'角度的平均值：<span class="subst">{get_averg()}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="2-初步完成核心"><a href="#2-初步完成核心" class="headerlink" title="2. 初步完成核心"></a>2. 初步完成<del>核心</del></h1><p><code>line_get.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指针角度值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pointer_rad</span><span class="params">(img)</span>:</span></span><br><span class="line">    shape = img.shape</span><br><span class="line">    c_y, c_x, depth = int(shape[<span class="number">0</span>] / <span class="number">2</span>), int(shape[<span class="number">1</span>] / <span class="number">2</span>), shape[<span class="number">2</span>]    <span class="comment"># h,w,cute</span></span><br><span class="line">    x1=c_x+c_x*<span class="number">1.5</span>  <span class="comment"># 指针长度--宽 2.5倍</span></span><br><span class="line">    src = img.copy()</span><br><span class="line">    freq_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">361</span>):        <span class="comment"># 算法</span></span><br><span class="line">        x = (x1 - c_x) * math.cos(i * math.pi / <span class="number">180</span>) + c_x</span><br><span class="line">        y = (x1 - c_x) * math.sin(i * math.pi / <span class="number">180</span>) + c_y</span><br><span class="line">        temp = src.copy()   <span class="comment"># 备份</span></span><br><span class="line">        cv2.line(temp, (c_x, c_y), (int(x), int(y)), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), thickness=<span class="number">1</span>)  <span class="comment"># 在temp上画线</span></span><br><span class="line">        t1 = img.copy()</span><br><span class="line">        t1[temp[:, :, <span class="number">1</span>] == <span class="number">255</span>] = <span class="number">255</span></span><br><span class="line">        c = img[temp[:, :, <span class="number">1</span>] == <span class="number">255</span>]</span><br><span class="line">        points = c[c == <span class="number">0</span>]</span><br><span class="line">        freq_list.append((len(points), i))</span><br><span class="line">        <span class="comment"># 可以展示匹配过程</span></span><br><span class="line">        <span class="comment"># cv2.imshow('d', temp)</span></span><br><span class="line">        <span class="comment"># cv2.imshow('d1', t1)</span></span><br><span class="line">        <span class="comment"># 如果要求固定检测时间不要太快，可以在这里调慢</span></span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line">    <span class="keyword">return</span> max(freq_list, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getthr</span><span class="params">(imgc)</span>:</span></span><br><span class="line">    thres = np.random.randint(<span class="number">40</span>,<span class="number">100</span>)   <span class="comment"># 随机数范围</span></span><br><span class="line">    imgfan = cv2.threshold(imgc, thres, <span class="number">255</span>, cv2.THRESH_BINARY)[<span class="number">1</span>]</span><br><span class="line">    max = get_pointer_rad(imgfan)</span><br><span class="line">    thr = max[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> thr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_averg</span><span class="params">(imgc,h)</span>:</span></span><br><span class="line">    tol = <span class="number">0</span></span><br><span class="line">    h = int(h)          <span class="comment"># 统计次数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(h):</span><br><span class="line">        thr = getthr(imgc)</span><br><span class="line">        tol = tol + thr</span><br><span class="line">        <span class="comment"># debug 看看角度是否正确统计</span></span><br><span class="line">        <span class="comment"># print(f'第{i+1}次的角度:{thr}')</span></span><br><span class="line">        print(i+<span class="number">1</span>,end=<span class="string">'、'</span>)</span><br><span class="line">    averg = tol / h</span><br><span class="line">    <span class="keyword">return</span> averg</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    img = cv2.imread(<span class="string">'./img/clock_re.png'</span>)</span><br><span class="line">    imgc = img[<span class="number">0</span>:<span class="number">165</span>, <span class="number">6</span>:<span class="number">171</span>]</span><br><span class="line">    print(<span class="string">f'角度的平均值：<span class="subst">{get_averg(imgc,<span class="number">5</span>)}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>xlsx_get.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> line_get <span class="keyword">as</span> lg</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_xlsx</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 新建xlsx或打开已有xlsx</span></span><br><span class="line">    filex = <span class="string">'data.xlsx'</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filex):</span><br><span class="line">        print(<span class="string">'--在result.xlsx中写入数据--'</span>)</span><br><span class="line">        wb = xl.load_workbook(<span class="string">'data.xlsx'</span>)</span><br><span class="line">        <span class="comment"># 文件表单定位</span></span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        wb = Workbook()</span><br><span class="line">        print(<span class="string">'--新建一个data.xlsx--'</span>)</span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 储存数据</span></span><br><span class="line">    ws = wb.active</span><br><span class="line">    ws[<span class="string">'A1'</span>] = <span class="string">'指针角度'</span></span><br><span class="line">    ws[<span class="string">'B1'</span>] = <span class="string">'转换角度'</span></span><br><span class="line">    ws[<span class="string">'C1'</span>] = <span class="string">'测试时间'</span></span><br><span class="line">    img = cv2.imread(<span class="string">'./img/clock_re.png'</span>)</span><br><span class="line">    imgh = img[<span class="number">0</span>:<span class="number">165</span>,<span class="number">6</span>:<span class="number">171</span>]</span><br><span class="line"></span><br><span class="line">    cishu = int(input(<span class="string">'请输入需要多少组数据--一直测则输入0--：'</span>))</span><br><span class="line">    pingjun = int(input(<span class="string">'请输入多少组算一次平均值--推荐10--:'</span>))</span><br><span class="line"></span><br><span class="line">    row = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> cishu == <span class="number">0</span> <span class="keyword">or</span> cishu &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">while</span> row &gt;= cishu :</span><br><span class="line">            maxrow = sheet.max_row</span><br><span class="line">            <span class="comment"># print(f'excel中第{maxrow + 1}行输入数据-----')</span></span><br><span class="line">            <span class="comment"># 测几次来算平均值 imgh,10--10次</span></span><br><span class="line">            thr = lg.get_averg(imgh,pingjun)</span><br><span class="line">            ws.cell(row=maxrow+<span class="number">1</span>,column=<span class="number">1</span>,value=thr)</span><br><span class="line">            print(<span class="string">f'第<span class="subst">{row + <span class="number">1</span>}</span>组-----角度平均值数据：<span class="subst">{thr}</span>，输入到第<span class="subst">{maxrow + <span class="number">1</span>}</span>行中'</span>)</span><br><span class="line">            <span class="keyword">if</span> thr&gt;<span class="number">0</span> <span class="keyword">and</span> thr&lt;=<span class="number">45</span>:</span><br><span class="line">                cdu = thr/<span class="number">2.25</span> +<span class="number">100</span></span><br><span class="line">            <span class="keyword">elif</span> thr&gt;=<span class="number">135</span> <span class="keyword">and</span> thr &lt;= <span class="number">360</span>:</span><br><span class="line">                cdu = (thr - <span class="number">135</span>)/<span class="number">2.25</span></span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                cdu = <span class="string">'故障'</span></span><br><span class="line">            ws.cell(row=maxrow+<span class="number">1</span>,column=<span class="number">2</span>,value=cdu)</span><br><span class="line">            timed = time.strftime(<span class="string">"%H:%M:%S"</span>, time.localtime())  <span class="comment"># %Y-%m-%d</span></span><br><span class="line">            ws.cell(row=maxrow+<span class="number">1</span>,column=<span class="number">3</span>,value=timed)</span><br><span class="line">            row += <span class="number">1</span></span><br><span class="line">            wb.save(<span class="string">'result.xlsx'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">while</span> row &lt; cishu :</span><br><span class="line">            maxrow = sheet.max_row</span><br><span class="line">            <span class="comment"># print(f'excel中第{maxrow + 1}行输入数据-----')</span></span><br><span class="line">            <span class="comment"># 测几次来算平均值 imgh,10--10次</span></span><br><span class="line">            thr = lg.get_averg(imgh,pingjun)</span><br><span class="line">            ws.cell(row=maxrow+<span class="number">1</span>,column=<span class="number">1</span>,value=thr)</span><br><span class="line">            print(<span class="string">f'第<span class="subst">{row + <span class="number">1</span>}</span>组-----角度平均值数据：<span class="subst">{thr}</span>，输入到第<span class="subst">{maxrow + <span class="number">1</span>}</span>行中'</span>)</span><br><span class="line">            <span class="keyword">if</span> thr&gt;<span class="number">0</span> <span class="keyword">and</span> thr&lt;=<span class="number">45</span>:</span><br><span class="line">                cdu = thr/<span class="number">2.25</span> +<span class="number">100</span></span><br><span class="line">            <span class="keyword">elif</span> thr&gt;=<span class="number">135</span> <span class="keyword">and</span> thr &lt;= <span class="number">360</span>:</span><br><span class="line">                cdu = (thr - <span class="number">135</span>)/<span class="number">2.25</span></span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                cdu = <span class="string">'故障'</span></span><br><span class="line">            ws.cell(row=maxrow+<span class="number">1</span>,column=<span class="number">2</span>,value=cdu)</span><br><span class="line">            timed = time.strftime(<span class="string">"%H:%M:%S"</span>, time.localtime())  <span class="comment"># %Y-%m-%d</span></span><br><span class="line">            ws.cell(row=maxrow+<span class="number">1</span>,column=<span class="number">3</span>,value=timed)</span><br><span class="line">            row += <span class="number">1</span></span><br><span class="line">            wb.save(<span class="string">'data.xlsx'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    get_xlsx()</span><br></pre></td></tr></tbody></table></figure>

<p><code>keshihua_data.py</code><br><strong>主要运行文件</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plotly.offline <span class="keyword">as</span> ptly</span><br><span class="line"><span class="keyword">import</span> plotly.graph_objs <span class="keyword">as</span> go</span><br><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">import</span> xlsx_get <span class="keyword">as</span> xg</span><br><span class="line"></span><br><span class="line">xg.get_xlsx()</span><br><span class="line">data=[]</span><br><span class="line">wb = xl.load_workbook(<span class="string">'data.xlsx'</span>)</span><br><span class="line">sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">ws = wb.active</span><br><span class="line"></span><br><span class="line">cdu = []</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> ws.iter_rows(min_row=<span class="number">2</span>, min_col=<span class="number">2</span>,max_col=<span class="number">2</span>,max_row=sheet.max_row ):</span><br><span class="line">    <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">        cdu.append(cell.value)</span><br><span class="line">timed = []</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> ws.iter_rows(min_row=<span class="number">2</span>, min_col=<span class="number">3</span>,max_col=<span class="number">3</span>,max_row=sheet.max_row ):</span><br><span class="line">    <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">        timed.append(cell.value)</span><br><span class="line"></span><br><span class="line">trace1 = go.Scatter(x = timed,</span><br><span class="line">                    y = cdu,</span><br><span class="line">                    mode = <span class="string">'lines+markers'</span>,   <span class="comment">#mode可选'markers','lines','lines+markers'</span></span><br><span class="line">                    name = <span class="string">'data'</span>,</span><br><span class="line">                    marker = dict(size = <span class="number">10</span>,        <span class="comment">#若设为变量则可用散点大小表示变量大小</span></span><br><span class="line">                                  color = <span class="string">'rgba(152, 0, 0, .8)'</span>,</span><br><span class="line">                                  line = dict(width = <span class="number">2</span>,</span><br><span class="line">                                              color = <span class="string">'rgb(0, 0, 0)'</span></span><br><span class="line">                                              ),</span><br><span class="line">                                  opacity=[]</span><br><span class="line">                                )</span><br><span class="line">            )</span><br><span class="line">data.append(trace1)</span><br><span class="line">layout = go.Layout(font=dict(family=<span class="string">'Courier New, monospace'</span>, size=<span class="number">18</span>, color=<span class="string">'#3D3D3D'</span>),</span><br><span class="line">                   title=<span class="string">'温度值'</span></span><br><span class="line">    )</span><br><span class="line">fig = go.Figure(data=data, layout=layout)</span><br><span class="line">ptly.plot(fig, filename = <span class="string">'data.html'</span>)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="3-进一步优化，直接再存到-excel-同时绘制图线，达到粗略得实时"><a href="#3-进一步优化，直接再存到-excel-同时绘制图线，达到粗略得实时" class="headerlink" title="3. 进一步优化，直接再存到 excel 同时绘制图线，达到粗略得实时"></a>3. 进一步优化，直接再存到 excel 同时绘制图线，达到粗略得实时</h1><p><code>keshihua_data_shishi.py</code></p>
<ul>
<li>1.实时显示，但不太美观，而且不丝滑</li>
<li>2.界面美观，但不会实时显示</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import plotly.offline as ptly</span></span><br><span class="line"><span class="comment"># import plotly.graph_objs as go</span></span><br><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">import</span> line_get <span class="keyword">as</span> lg</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_xlsx</span><span class="params">(thr,cdu,timed)</span>:</span></span><br><span class="line">    filex = <span class="string">'ssdata.xlsx'</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filex):</span><br><span class="line">        print(<span class="string">f'--在ssdata.xlsx中写入数据--'</span>)</span><br><span class="line">        wb = xl.load_workbook(<span class="string">'ssdata.xlsx'</span>)</span><br><span class="line">        <span class="comment"># 文件表单定位</span></span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        wb = Workbook()</span><br><span class="line">        print(<span class="string">'--新建一个ssdata.xlsx--'</span>)</span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line"></span><br><span class="line">    ws = wb.active</span><br><span class="line">    ws[<span class="string">'A1'</span>] = <span class="string">'指针角度'</span></span><br><span class="line">    ws[<span class="string">'B1'</span>] = <span class="string">'转换角度'</span></span><br><span class="line">    ws[<span class="string">'C1'</span>] = <span class="string">'测试时间'</span></span><br><span class="line"></span><br><span class="line">    maxrow = sheet.max_row + <span class="number">1</span></span><br><span class="line">    ws.cell(row=maxrow,column=<span class="number">1</span>,value=thr)</span><br><span class="line">    ws.cell(row=maxrow,column=<span class="number">2</span>,value=cdu)</span><br><span class="line">    ws.cell(row=maxrow,column=<span class="number">3</span>,value=timed)</span><br><span class="line"></span><br><span class="line">    wb.save(<span class="string">'ssdata.xlsx'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cts</span><span class="params">()</span>:</span></span><br><span class="line">    filex = <span class="string">'ssdata.xlsx'</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filex):</span><br><span class="line">        print(<span class="string">f'--在ssdata.xlsx中写入数据--'</span>)</span><br><span class="line">        wb = xl.load_workbook(<span class="string">'ssdata.xlsx'</span>)</span><br><span class="line">        <span class="comment"># 文件表单定位</span></span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        wb = Workbook()</span><br><span class="line">        print(<span class="string">'--新建一个ssdata.xlsx--'</span>)</span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    ws = wb.active</span><br><span class="line">    cdu = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> ws.iter_rows(min_row=<span class="number">2</span>, min_col=<span class="number">2</span>,max_col=<span class="number">2</span>,max_row=sheet.max_row ):</span><br><span class="line">        <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">            cdu.append(str(cell.value))</span><br><span class="line">    timed = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> ws.iter_rows(min_row=<span class="number">2</span>, min_col=<span class="number">3</span>,max_col=<span class="number">3</span>,max_row=sheet.max_row ):</span><br><span class="line">        <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">            timed.append(cell.value)</span><br><span class="line">    <span class="keyword">return</span> cdu,timed</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_shishi</span><span class="params">(cishu,pingjun)</span>:</span></span><br><span class="line">    img = cv2.imread(<span class="string">'./img/clock_re.png'</span>)</span><br><span class="line">    imgh = img[<span class="number">0</span>:<span class="number">165</span>,<span class="number">6</span>:<span class="number">171</span>]</span><br><span class="line"></span><br><span class="line">    row = <span class="number">0</span></span><br><span class="line">    cts = get_cts()</span><br><span class="line">    cdus = cts[<span class="number">0</span>]</span><br><span class="line">    timeds = cts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> row &gt;= cishu :</span><br><span class="line">        thr = lg.get_averg(imgh,pingjun)</span><br><span class="line">        <span class="keyword">if</span> thr &gt; <span class="number">0</span> <span class="keyword">and</span> thr &lt;= <span class="number">45</span>:</span><br><span class="line">            cdu = thr / <span class="number">2.25</span> + <span class="number">100</span></span><br><span class="line">        <span class="keyword">elif</span> thr &gt;= <span class="number">135</span> <span class="keyword">and</span> thr &lt;= <span class="number">360</span>:</span><br><span class="line">            cdu = (thr - <span class="number">135</span>) / <span class="number">2.25</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cdu = <span class="string">'测试故障'</span></span><br><span class="line">        cdus.append(str(cdu))</span><br><span class="line">        timed = time.strftime(<span class="string">"%H:%M:%S"</span>, time.localtime())</span><br><span class="line">        timeds.append(timed)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        save_xlsx(thr,cdu,timed)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># plt.figure(1)</span></span><br><span class="line">        plt.clf()  <span class="comment"># 清空画布上的所有内容</span></span><br><span class="line">        fig1 = plt.figure(num=<span class="string">'温度-时间'</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>), dpi=<span class="number">75</span>, facecolor=<span class="string">'#FFFFFF'</span>, edgecolor=<span class="string">'#0000FF'</span>)</span><br><span class="line">        plt.xlabel(<span class="string">'Time'</span>)</span><br><span class="line">        plt.ylabel(<span class="string">'Temp'</span>)</span><br><span class="line">        plt.plot(timeds, cdus, <span class="string">'r-s'</span>)</span><br><span class="line">        <span class="comment"># plt.draw()  # 注意此函数需要调用</span></span><br><span class="line">        <span class="comment"># time.sleep(0.01)</span></span><br><span class="line">        plt.pause(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(timeds) &gt;= <span class="number">22</span>:</span><br><span class="line">            timeds = []</span><br><span class="line">            cdus = []</span><br><span class="line">            plt.clf()</span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># # plotly 数据可视化 美观，可是不会动态</span></span><br><span class="line">        <span class="comment"># data = []</span></span><br><span class="line">        <span class="comment"># namee = str(round(cdu,1)) + '°C'</span></span><br><span class="line">        <span class="comment"># trace1 = go.Scatter(x=timeds,</span></span><br><span class="line">        <span class="comment">#                     y=cdus,</span></span><br><span class="line">        <span class="comment">#                     mode='lines+markers',  # mode可选'markers','lines','lines+markers'</span></span><br><span class="line">        <span class="comment">#                     name= namee,</span></span><br><span class="line">        <span class="comment">#                     marker=dict(size=10,  # 若设为变量则可用散点大小表示变量大小</span></span><br><span class="line">        <span class="comment">#                                 color='rgba(152, 0, 0, .8)',</span></span><br><span class="line">        <span class="comment">#                                 line=dict(width=2,</span></span><br><span class="line">        <span class="comment">#                                           color='rgb(0, 0, 0)'</span></span><br><span class="line">        <span class="comment">#                                           ),</span></span><br><span class="line">        <span class="comment">#                                 opacity=[]</span></span><br><span class="line">        <span class="comment">#                                 )</span></span><br><span class="line">        <span class="comment">#                     )</span></span><br><span class="line">        <span class="comment"># data.append(trace1)</span></span><br><span class="line">        <span class="comment"># axis_template = dict(</span></span><br><span class="line">        <span class="comment">#     showgrid=True,  # 网格</span></span><br><span class="line">        <span class="comment">#     zeroline=True,  # 是否显示基线,即沿着(0,0)画出x轴和y轴</span></span><br><span class="line">        <span class="comment">#     nticks=20,</span></span><br><span class="line">        <span class="comment">#     showline=True,</span></span><br><span class="line">        <span class="comment">#     title='Time',</span></span><br><span class="line">        <span class="comment">#     mirror='all',</span></span><br><span class="line">        <span class="comment">#     zerolinecolor="#FF0000"</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="comment"># ayis_template = dict(</span></span><br><span class="line">        <span class="comment">#     showgrid=True,  # 网格</span></span><br><span class="line">        <span class="comment">#     zeroline=True,  # 是否显示基线,即沿着(0,0)画出x轴和y轴</span></span><br><span class="line">        <span class="comment">#     nticks=20,</span></span><br><span class="line">        <span class="comment">#     showline=True,</span></span><br><span class="line">        <span class="comment">#     title='Temp',</span></span><br><span class="line">        <span class="comment">#     mirror='all',</span></span><br><span class="line">        <span class="comment">#     zerolinecolor="#FF0000"</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="comment"># layout = go.Layout(font=dict(family='Courier New, monospace', size=18, color='#3D3D3D'),</span></span><br><span class="line">        <span class="comment">#                    title='温度值' ,xaxis=axis_template,yaxis=ayis_template</span></span><br><span class="line">        <span class="comment">#                    )</span></span><br><span class="line">        <span class="comment"># fig = go.Figure(data=data, layout=layout)</span></span><br><span class="line">        <span class="comment"># ptly.plot(fig, filename='ssdata.html')</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    get_shishi(<span class="number">0</span>,<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>keshihua_shishi.py</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> keshihua_data_shishi <span class="keyword">as</span> kds</span><br><span class="line"></span><br><span class="line">cishu = <span class="number">0</span>   <span class="comment"># 0 - 一直测</span></span><br><span class="line">pingjun = int(input(<span class="string">'请输入多少组算一次平均数--建议10组--:'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    kds.get_shishi(cishu,pingjun)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="4-粗糙的整合–待优化"><a href="#4-粗糙的整合–待优化" class="headerlink" title="4. 粗糙的整合–待优化"></a>4. 粗糙的整合–待优化</h1><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> plotly.offline <span class="keyword">as</span> ptly</span><br><span class="line"><span class="keyword">import</span> plotly.graph_objs <span class="keyword">as</span> go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指针角度值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pointer_rad</span><span class="params">(img)</span>:</span></span><br><span class="line">    shape = img.shape</span><br><span class="line">    c_y, c_x, depth = int(shape[<span class="number">0</span>] / <span class="number">2</span>), int(shape[<span class="number">1</span>] / <span class="number">2</span>), shape[<span class="number">2</span>]    <span class="comment"># h,w,cute</span></span><br><span class="line">    x1=c_x+c_x*<span class="number">1.5</span>  <span class="comment"># 指针长度--宽 2.5倍</span></span><br><span class="line">    src = img.copy()</span><br><span class="line">    freq_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">361</span>):        <span class="comment"># 算法</span></span><br><span class="line">        x = (x1 - c_x) * math.cos(i * math.pi / <span class="number">180</span>) + c_x</span><br><span class="line">        y = (x1 - c_x) * math.sin(i * math.pi / <span class="number">180</span>) + c_y</span><br><span class="line">        temp = src.copy()   <span class="comment"># 备份</span></span><br><span class="line">        cv2.line(temp, (c_x, c_y), (int(x), int(y)), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), thickness=<span class="number">1</span>)  <span class="comment"># 在temp上画线</span></span><br><span class="line">        t1 = img.copy()</span><br><span class="line">        t1[temp[:, :, <span class="number">1</span>] == <span class="number">255</span>] = <span class="number">255</span></span><br><span class="line">        c = img[temp[:, :, <span class="number">1</span>] == <span class="number">255</span>]</span><br><span class="line">        points = c[c == <span class="number">0</span>]</span><br><span class="line">        freq_list.append((len(points), i))</span><br><span class="line">        <span class="comment"># 可以展示匹配过程</span></span><br><span class="line">        <span class="comment"># cv2.imshow('d', temp)</span></span><br><span class="line">        <span class="comment"># cv2.imshow('d1', t1)</span></span><br><span class="line">        <span class="comment"># 如果要求固定检测时间不要太快，可以在这里调慢</span></span><br><span class="line">        cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line">    <span class="keyword">return</span> max(freq_list, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getthr</span><span class="params">(imgc)</span>:</span></span><br><span class="line">    thres = np.random.randint(<span class="number">40</span>,<span class="number">100</span>)   <span class="comment"># 随机数范围</span></span><br><span class="line">    imgfan = cv2.threshold(imgc, thres, <span class="number">255</span>, cv2.THRESH_BINARY)[<span class="number">1</span>]</span><br><span class="line">    max = get_pointer_rad(imgfan)</span><br><span class="line">    thr = max[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> thr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_averg</span><span class="params">(imgc,h)</span>:</span></span><br><span class="line">    tol = <span class="number">0</span></span><br><span class="line">    h = int(h)          <span class="comment"># 统计次数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(h):</span><br><span class="line">        thr = getthr(imgc)</span><br><span class="line">        tol = tol + thr</span><br><span class="line">        <span class="comment"># debug 看看角度是否正确统计</span></span><br><span class="line">        <span class="comment"># print(f'第{i+1}次的角度:{thr}')</span></span><br><span class="line">        print(i+<span class="number">1</span>,end=<span class="string">'、'</span>)</span><br><span class="line">    averg = tol / h</span><br><span class="line">    <span class="keyword">return</span> averg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_xlsx</span><span class="params">(thr,cdu,timed)</span>:</span></span><br><span class="line">    filex = <span class="string">'ssdata.xlsx'</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filex):</span><br><span class="line">        print(<span class="string">f'--在ssdata.xlsx中写入数据--'</span>)</span><br><span class="line">        wb = xl.load_workbook(<span class="string">'ssdata.xlsx'</span>)</span><br><span class="line">        <span class="comment"># 文件表单定位</span></span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        wb = Workbook()</span><br><span class="line">        print(<span class="string">'--新建一个ssdata.xlsx--'</span>)</span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line"></span><br><span class="line">    ws = wb.active</span><br><span class="line">    ws[<span class="string">'A1'</span>] = <span class="string">'指针角度'</span></span><br><span class="line">    ws[<span class="string">'B1'</span>] = <span class="string">'转换角度'</span></span><br><span class="line">    ws[<span class="string">'C1'</span>] = <span class="string">'测试时间'</span></span><br><span class="line"></span><br><span class="line">    maxrow = sheet.max_row + <span class="number">1</span></span><br><span class="line">    ws.cell(row=maxrow,column=<span class="number">1</span>,value=thr)</span><br><span class="line">    ws.cell(row=maxrow,column=<span class="number">2</span>,value=cdu)</span><br><span class="line">    ws.cell(row=maxrow,column=<span class="number">3</span>,value=timed)</span><br><span class="line"></span><br><span class="line">    wb.save(<span class="string">'ssdata.xlsx'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cts</span><span class="params">()</span>:</span></span><br><span class="line">    filex = <span class="string">'ssdata.xlsx'</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filex):</span><br><span class="line">        print(<span class="string">f'--在ssdata.xlsx中写入数据--'</span>)</span><br><span class="line">        wb = xl.load_workbook(<span class="string">'ssdata.xlsx'</span>)</span><br><span class="line">        <span class="comment"># 文件表单定位</span></span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        wb = Workbook()</span><br><span class="line">        print(<span class="string">'--新建一个ssdata.xlsx--'</span>)</span><br><span class="line">        sheet = wb[<span class="string">'Sheet'</span>]</span><br><span class="line">    ws = wb.active</span><br><span class="line">    cdu = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> ws.iter_rows(min_row=<span class="number">2</span>, min_col=<span class="number">2</span>,max_col=<span class="number">2</span>,max_row=sheet.max_row ):</span><br><span class="line">        <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">            cdu.append(str(cell.value))</span><br><span class="line">    timed = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> ws.iter_rows(min_row=<span class="number">2</span>, min_col=<span class="number">3</span>,max_col=<span class="number">3</span>,max_row=sheet.max_row ):</span><br><span class="line">        <span class="keyword">for</span> cell <span class="keyword">in</span> row:</span><br><span class="line">            timed.append(cell.value)</span><br><span class="line">    <span class="keyword">return</span> cdu,timed</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_shishi</span><span class="params">(cishu,pingjun)</span>:</span></span><br><span class="line">    <span class="comment"># img = cv2.imread('./img/clock_re.png')</span></span><br><span class="line">    imgh = cv2.imread(<span class="string">'frame.jpg'</span>)</span><br><span class="line">    <span class="comment"># imgh = img[0:165,6:171]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取excle中数据</span></span><br><span class="line">    cts = get_cts()</span><br><span class="line">    cdus = cts[<span class="number">0</span>]</span><br><span class="line">    timeds = cts[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    row = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> row:</span><br><span class="line">        thr = get_averg(imgh,pingjun)</span><br><span class="line">        <span class="keyword">if</span> thr &gt; <span class="number">0</span> <span class="keyword">and</span> thr &lt;= <span class="number">45</span>:</span><br><span class="line">            cdu = thr / <span class="number">2.25</span> + <span class="number">100</span></span><br><span class="line">        <span class="keyword">elif</span> thr &gt;= <span class="number">135</span> <span class="keyword">and</span> thr &lt;= <span class="number">360</span>:</span><br><span class="line">            cdu = (thr - <span class="number">135</span>) / <span class="number">2.25</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cdu = <span class="string">'测试故障'</span></span><br><span class="line">        cdus.append(str(cdu))</span><br><span class="line">        timed = time.strftime(<span class="string">"%H:%M:%S"</span>, time.localtime())</span><br><span class="line">        timeds.append(timed)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        save_xlsx(thr,cdu,timed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># # plotly 数据可视化 美观，可是不会动态</span></span><br><span class="line">        <span class="comment"># data = []</span></span><br><span class="line">        <span class="comment"># cdu1 = round(cdu ,1)</span></span><br><span class="line">        <span class="comment"># namee = str(cdu1) + '°C'</span></span><br><span class="line">        <span class="comment"># trace1 = go.Scatter(x=timeds,</span></span><br><span class="line">        <span class="comment">#                     y=cdus,</span></span><br><span class="line">        <span class="comment">#                     mode='lines+markers',  # mode可选'markers','lines','lines+markers'</span></span><br><span class="line">        <span class="comment">#                     name= namee,</span></span><br><span class="line">        <span class="comment">#                     marker=dict(size=10,  # 若设为变量则可用散点大小表示变量大小</span></span><br><span class="line">        <span class="comment">#                                 color='rgba(152, 0, 0, .8)',</span></span><br><span class="line">        <span class="comment">#                                 line=dict(width=2,</span></span><br><span class="line">        <span class="comment">#                                           color='rgb(0, 0, 0)'</span></span><br><span class="line">        <span class="comment">#                                           ),</span></span><br><span class="line">        <span class="comment">#                                 opacity=[]</span></span><br><span class="line">        <span class="comment">#                                 )</span></span><br><span class="line">        <span class="comment">#                     )</span></span><br><span class="line">        <span class="comment"># data.append(trace1)</span></span><br><span class="line">        <span class="comment"># axis_template = dict(</span></span><br><span class="line">        <span class="comment">#     showgrid=True,  # 网格</span></span><br><span class="line">        <span class="comment">#     zeroline=True,  # 是否显示基线,即沿着(0,0)画出x轴和y轴</span></span><br><span class="line">        <span class="comment">#     nticks=20,</span></span><br><span class="line">        <span class="comment">#     showline=True,</span></span><br><span class="line">        <span class="comment">#     title='Time',</span></span><br><span class="line">        <span class="comment">#     mirror='all',</span></span><br><span class="line">        <span class="comment">#     zerolinecolor="#FF0000"</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="comment"># ayis_template = dict(</span></span><br><span class="line">        <span class="comment">#     showgrid=True,  # 网格</span></span><br><span class="line">        <span class="comment">#     zeroline=True,  # 是否显示基线,即沿着(0,0)画出x轴和y轴</span></span><br><span class="line">        <span class="comment">#     nticks=20,</span></span><br><span class="line">        <span class="comment">#     showline=True,</span></span><br><span class="line">        <span class="comment">#     title='Temp',</span></span><br><span class="line">        <span class="comment">#     mirror='all',</span></span><br><span class="line">        <span class="comment">#     zerolinecolor="#FF0000"</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="comment"># layout = go.Layout(font=dict(family='Courier New, monospace', size=18, color='#3D3D3D'),</span></span><br><span class="line">        <span class="comment">#                    title='温度值' ,xaxis=axis_template,yaxis=ayis_template</span></span><br><span class="line">        <span class="comment">#                    )</span></span><br><span class="line">        <span class="comment"># fig = go.Figure(data=data, layout=layout)</span></span><br><span class="line">        <span class="comment"># ptly.plot(fig, filename='ssdata.html')</span></span><br><span class="line">        <span class="comment"># break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 实时数据，停不下来</span></span><br><span class="line">        <span class="comment"># plt.figure(1)</span></span><br><span class="line">        plt.clf()  <span class="comment"># 清空画布上的所有内容</span></span><br><span class="line">        fig1 = plt.figure(num=<span class="string">'温度-时间'</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>), dpi=<span class="number">75</span>, facecolor=<span class="string">'#FFFFFF'</span>, edgecolor=<span class="string">'#0000FF'</span>)</span><br><span class="line">        plt.xlabel(<span class="string">'Time'</span>)</span><br><span class="line">        plt.ylabel(<span class="string">'Temp'</span>)</span><br><span class="line">        plt.plot(timeds, cdus, <span class="string">'r-s'</span>)</span><br><span class="line">        <span class="comment"># plt.draw()  # 注意此函数需要调用</span></span><br><span class="line">        <span class="comment"># time.sleep(0.01)</span></span><br><span class="line">        plt.pause(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(timeds) &gt;= <span class="number">22</span>:</span><br><span class="line">            timeds = []</span><br><span class="line">            cdus = []</span><br><span class="line">            plt.clf()</span><br><span class="line">            row = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">video_show</span><span class="params">(video,ci)</span>:</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        ret1,frame = video.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ret1:</span><br><span class="line">            print(<span class="string">"视频获取失败！"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        framegray = cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        template = cv2.imread(<span class="string">'./img/moban_c.jpg'</span>)</span><br><span class="line">        <span class="comment"># print(template.shape)</span></span><br><span class="line">        <span class="comment"># exit()</span></span><br><span class="line">        theight , twidth = template.shape[<span class="number">0</span>] , template.shape[<span class="number">1</span>]</span><br><span class="line">        result = cv2.matchTemplate(frame,template,cv2.TM_SQDIFF_NORMED)</span><br><span class="line">        cv2.normalize(result,result,<span class="number">0</span>,<span class="number">1</span>,cv2.NORM_MINMAX,<span class="number">-1</span>)</span><br><span class="line">        min_val,max_val,min_loc,max_loc = cv2.minMaxLoc(result)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # min_loc：矩形定点</span></span><br><span class="line">        <span class="comment"># # (min_loc[0]+twidth,min_loc[1]+theight)：矩形的宽高</span></span><br><span class="line">        <span class="comment"># # (0,0,225)：矩形的边框颜色；2：矩形边框宽度</span></span><br><span class="line">        cv2.rectangle(frame ,min_loc ,(min_loc[<span class="number">0</span>] + twidth ,min_loc[<span class="number">1</span>] + theight) ,(<span class="number">255</span> ,<span class="number">0</span> ,<span class="number">0</span>) ,<span class="number">2</span>)</span><br><span class="line">        cv2.imshow(<span class="string">"Video_show"</span>,frame)</span><br><span class="line"></span><br><span class="line">        choose_data = framegray[min_loc[<span class="number">0</span>]:(min_loc[<span class="number">0</span>] + twidth ),min_loc[<span class="number">1</span>]: (min_loc[<span class="number">1</span>] + theight)]</span><br><span class="line">        <span class="comment"># choose_datafan = cv2.threshold(choose_data ,110,255 ,cv2.THRESH_BINARY_INV)[1]</span></span><br><span class="line">        cv2.imshow(<span class="string">"choose_video"</span>,choose_data)</span><br><span class="line">        <span class="keyword">if</span> i%ci == <span class="number">0</span> :</span><br><span class="line">            cv2.imwrite(<span class="string">f'frame.jpg'</span>,choose_data)</span><br><span class="line">            print(<span class="string">f'照片已保存--frame.jpg--：'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cv2.waitKey(<span class="number">1</span>) &amp; <span class="number">0xff</span> == ord(<span class="string">"e"</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    video.release()</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span> :</span><br><span class="line">    cishu = <span class="number">0</span>  <span class="comment"># 0 - 一直测</span></span><br><span class="line">    <span class="comment"># pingjun = int(input('请输入多少组算一次平均数--建议2组--:'))</span></span><br><span class="line">    pingjun = <span class="number">5</span></span><br><span class="line">    ci = <span class="number">100</span></span><br><span class="line">    <span class="comment"># ci = int(input('请输入多少时间换一组照片--100大概3.638s左右--：'))</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        video = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">        video_show(video ,ci)</span><br><span class="line">        get_shishi(cishu ,pingjun)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="5-进一步优化"><a href="#5-进一步优化" class="headerlink" title="5. 进一步优化"></a>5. 进一步优化</h1><h2 id="5-1-分析误差的准备"><a href="#5-1-分析误差的准备" class="headerlink" title="5.1 分析误差的准备"></a>5.1 分析误差的准备</h2><h3 id="5-1-1-构造一个桌面指针"><a href="#5-1-1-构造一个桌面指针" class="headerlink" title="5.1.1 构造一个桌面指针"></a>5.1.1 构造一个桌面指针</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime <span class="keyword">as</span> dt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawuse</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># background</span></span><br><span class="line">    game = t.Screen()</span><br><span class="line">    game.bgcolor(<span class="string">'#A4D3EE'</span>)</span><br><span class="line">    game.setup(<span class="number">500</span>,<span class="number">500</span>,<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">    game.tracer(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    pen = t.Turtle()</span><br><span class="line">    pen.ht()</span><br><span class="line">    pen.speed(<span class="number">0</span>)</span><br><span class="line">    pen.up()</span><br><span class="line">    pen.pensize(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">draw</span><span class="params">()</span>:</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            pen.clear()</span><br><span class="line">            <span class="comment"># 圆</span></span><br><span class="line">            pen.pensize(<span class="number">3</span>)</span><br><span class="line">            pen.up()</span><br><span class="line">            pen.color(<span class="string">'black'</span>)</span><br><span class="line">            pen.goto(<span class="number">0</span>,<span class="number">-200</span>)</span><br><span class="line">            pen.down()</span><br><span class="line">            pen.seth(<span class="number">0</span>)</span><br><span class="line">            pen.circle(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 刻度</span></span><br><span class="line">            pen.up()</span><br><span class="line">            pen.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">            pen.seth(<span class="number">225</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">13</span>):</span><br><span class="line">                pen.fd(<span class="number">180</span>)</span><br><span class="line">                pen.down()</span><br><span class="line">                pen.fd(<span class="number">20</span>)</span><br><span class="line">                pen.up()</span><br><span class="line">                pen.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                pen.right(<span class="number">22.5</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 指针</span></span><br><span class="line">            pen.up()</span><br><span class="line">            pen.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">            pen.down()</span><br><span class="line">            pen.seth(<span class="number">225</span> - i)</span><br><span class="line">            pen.color(<span class="string">'red'</span>)</span><br><span class="line">            pen.pensize(<span class="number">6</span>)</span><br><span class="line">            pen.fd(<span class="number">120</span>)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i &gt;= <span class="number">271</span>:</span><br><span class="line">                i = <span class="number">0</span></span><br><span class="line">            game.update()</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">drawgd</span><span class="params">(thr)</span>:</span></span><br><span class="line">        pen.clear()</span><br><span class="line">        <span class="comment"># 圆</span></span><br><span class="line">        pen.up()</span><br><span class="line">        pen.color(<span class="string">'black'</span>)</span><br><span class="line">        pen.goto(<span class="number">0</span>,<span class="number">-200</span>)</span><br><span class="line">        pen.down()</span><br><span class="line">        pen.seth(<span class="number">0</span>)</span><br><span class="line">        pen.circle(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 刻度</span></span><br><span class="line">        pen.up()</span><br><span class="line">        pen.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">        pen.seth(<span class="number">225</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">13</span>):</span><br><span class="line">            pen.fd(<span class="number">180</span>)</span><br><span class="line">            pen.down()</span><br><span class="line">            pen.fd(<span class="number">20</span>)</span><br><span class="line">            pen.up()</span><br><span class="line">            pen.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">            pen.right(<span class="number">22.5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 指针</span></span><br><span class="line">        pen.up()</span><br><span class="line">        pen.goto(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">        pen.down()</span><br><span class="line">        pen.seth(<span class="number">225</span> - thr)</span><br><span class="line">        pen.color(<span class="string">'red'</span>)</span><br><span class="line">        pen.pensize(<span class="number">6</span>)</span><br><span class="line">        pen.fd(<span class="number">120</span>)</span><br><span class="line">        game.update()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模式一--动态</span></span><br><span class="line">    draw()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 模式二--固定</span></span><br><span class="line">    <span class="comment"># thr = int(input("输入指针度数:--角度--"))</span></span><br><span class="line">    <span class="comment"># drawgd(thr)</span></span><br><span class="line"></span><br><span class="line">    game.mainloop()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="5-1-2-手机上下载一个模拟时钟"><a href="#5-1-2-手机上下载一个模拟时钟" class="headerlink" title="5.1.2 手机上下载一个模拟时钟"></a>5.1.2 手机上下载一个模拟时钟</h3><h3 id="5-1-3-获取两者数据对比来分析误差"><a href="#5-1-3-获取两者数据对比来分析误差" class="headerlink" title="5.1.3 获取两者数据对比来分析误差"></a>5.1.3 获取两者数据对比来分析误差</h3><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="tags"><a href="/tags/Python/"><i class="fa fa-tag"></i>Python</a><a href="/tags/Compete/"><i class="fa fa-tag"></i>Compete</a></div><div class="post-nav"><a class="pre" href="/2020/02/20/python-math/">Python中math库的学习</a><a class="next" href="/2020/02/18/python-open-cv/">Python中Opencv库的学习</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Bilibili/" style="font-size: 15px;">Bilibili</a> <a href="/tags/Compete/" style="font-size: 15px;">Compete</a> <a href="/tags/Spider/" style="font-size: 15px;">Spider</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 15px;">单片机</a> <a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Note/" style="font-size: 15px;">Note</a> <a href="/tags/Jsoup/" style="font-size: 15px;">Jsoup</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Server/" style="font-size: 15px;">Server</a> <a href="/tags/VB/" style="font-size: 15px;">VB</a> <a href="/tags/C/" style="font-size: 15px;">C#</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Questions/" style="font-size: 15px;">Questions</a> <a href="/tags/Api/" style="font-size: 15px;">Api</a> <a href="/tags/Source/" style="font-size: 15px;">Source</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Life/" style="font-size: 15px;">Life</a> <a href="/tags/Imagination/" style="font-size: 15px;">Imagination</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E5%8A%9B/">学习力</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%B3%E8%B1%A1%E5%8A%9B/">想象力</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%8A%9B/">技术力</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A0%E5%8A%9B/">无力</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%8A%9B/">资源力</a><span class="category-list-count">3</span></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Yun.Qi.</a> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> | Theme by<a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Maupassant</a><br/><span class="footer-birthday-text">Birthday</span><span class="footer-birthday-date">2020/02/04</span></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>