<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="summary"><title>Spider-Note | Yun.Qi</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.png"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Spider-Note</h1><a id="logo" href="/.">Yun.Qi</a><p class="summary">Note/Diary</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Spider-Note</h1><div class="post-meta">2020-02-08<span> | </span><span class="category"><a href="/categories/%E5%AD%A6%E4%B9%A0%E5%8A%9B/">学习力</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 9,819</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 42</span><span class="post-meta-item-text"> Minutes</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-线程"><span class="toc-text">1. 线程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-线程-Pool"><span class="toc-text">1.1 线程 Pool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-所用函数"><span class="toc-text">1.2 所用函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-request-库"><span class="toc-text">2. request 库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-基础用法"><span class="toc-text">2.1 基础用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-进阶用法"><span class="toc-text">2.2 进阶用法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-re-库"><span class="toc-text">3. re 库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-基础用法"><span class="toc-text">3.1 基础用法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-正则表达式"><span class="toc-text">4. 正则表达式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Xpath–lxml-库"><span class="toc-text">5. Xpath–lxml 库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-XPath-语法"><span class="toc-text">5.1 XPath 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-XPath-语法解析"><span class="toc-text">5.1.1 XPath 语法解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-基本框架"><span class="toc-text">5.1.2 基本框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-example"><span class="toc-text">5.1.3 example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-XPath-通过-chrome-辅助构造"><span class="toc-text">5.2 XPath 通过 chrome 辅助构造</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Beautiful-Soup4-库-BS4"><span class="toc-text">6. Beautiful Soup4 库(BS4)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-bs4-处理步骤"><span class="toc-text">6.1 bs4 处理步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-example"><span class="toc-text">6.2 example</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-异步加载与请求头"><span class="toc-text">7. 异步加载与请求头</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-异步加载"><span class="toc-text">7.1 异步加载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-AJAX-技术"><span class="toc-text">7.1.1 AJAX 技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-JSON"><span class="toc-text">7.1.2 JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-3-异步-GET-与-POST-请求"><span class="toc-text">7.1.3 异步 GET 与 POST 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-4-特殊的异步加载"><span class="toc-text">7.1.4 特殊的异步加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-5-多次请求的异步加载"><span class="toc-text">7.1.5 多次请求的异步加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-6-基于异步加载的简单登录"><span class="toc-text">7.1.6 基于异步加载的简单登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-请求头"><span class="toc-text">7.2 请求头</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-请求头的作用"><span class="toc-text">7.2.1 请求头的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-伪造请求头"><span class="toc-text">7.2.2 伪造请求头</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-模拟浏览器"><span class="toc-text">7.3 模拟浏览器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1-Selenium-介绍"><span class="toc-text">7.3.1 Selenium 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-2-selenium-安装"><span class="toc-text">7.3.2 selenium 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-3-selenium-的使用"><span class="toc-text">7.3.3 selenium 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-1-获取源代码"><span class="toc-text">7.3.3.1 获取源代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-2-等待信息出现"><span class="toc-text">7.3.3.2 等待信息出现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-3-在网页中获取元素"><span class="toc-text">7.3.3.3 在网页中获取元素</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-实例：乐视爬取视频评论"><span class="toc-text">7.4 实例：乐视爬取视频评论</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-模拟登录与验证码"><span class="toc-text">8. 模拟登录与验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-模拟登录"><span class="toc-text">8.1 模拟登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-使用-Selenium-模拟登录"><span class="toc-text">8.1.1 使用 Selenium 模拟登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-使用-Cookies-登录"><span class="toc-text">8.1.2 使用 Cookies 登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-模拟表单登录"><span class="toc-text">8.1.3 模拟表单登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-验证码"><span class="toc-text">8.2 验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-肉眼打码"><span class="toc-text">8.2.1 肉眼打码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-自动打码"><span class="toc-text">8.2.2 自动打码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-案例-自动登录果壳网"><span class="toc-text">8.3 案例-自动登录果壳网</span></a></li></ol></li></ol></div></div><div class="post-content"><blockquote>
<p>参考 Github 上的<a href="https://github.com/kingname/SourceCodeOfBook" target="_blank" rel="noopener" title="Github">教程</a>学习<br>一个连 python 都没有完全学会的菜鸡来学爬虫</p>
</blockquote>
<a id="more"></a>

<h1 id="1-线程"><a href="#1-线程" class="headerlink" title="1. 线程"></a>1. 线程</h1><h2 id="1-1-线程-Pool"><a href="#1-1-线程-Pool" class="headerlink" title="1.1 线程 Pool"></a>1.1 线程 Pool</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_power2</span><span class="params">(num)</span>:</span></span><br><span class="line"><span class="keyword">return</span> num*num</span><br><span class="line">pool = Pool(<span class="number">5</span>)</span><br><span class="line">origin_num = [x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">result = pool.map(calc_power2,origin_num)</span><br><span class="line">print(<span class="string">f'0~9的平方分别为：<span class="subst">{result}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>Pool(5)</code>  五个线程</p>
<hr>

<h2 id="1-2-所用函数"><a href="#1-2-所用函数" class="headerlink" title="1.2 所用函数"></a>1.2 所用函数</h2><p><code>time.time()</code> &nbsp; 程序当前时间<br>eg：用来对比单线程和多线程访问 baidu 的速度</p>
<h1 id="2-request-库"><a href="#2-request-库" class="headerlink" title="2. request 库"></a>2. request 库</h1><h2 id="2-1-基础用法"><a href="#2-1-基础用法" class="headerlink" title="2.1 基础用法"></a>2.1 基础用法</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">''</span></span><br><span class="line">headers = {</span><br><span class="line">    <span class="string">"UserAgent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like\ Gecko) Chrome/80.0.3987.87 Safari/537.36 Edg/80.0.361.48"</span></span><br><span class="line">}</span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line">response.encoding = <span class="string">'utf-8'</span>  <span class="comment">#或者GBK</span></span><br><span class="line">html = response.text</span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-2-进阶用法"><a href="#2-2-进阶用法" class="headerlink" title="2.2 进阶用法"></a>2.2 进阶用法</h2><ul>
<li><strong>使用 requests 模拟发送 get 请求</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/ajax_1_backend'</span></span><br><span class="line">html = requests.get(url).content.decode()</span><br><span class="line">print(html)</span><br><span class="line"><span class="comment"># 如果你看到这一段文字，说明你已经成功访问了这个页面,并获取了GET方式的异步加载数据。</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>使用 requests 模拟发送 post 请求</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/ajax_1_postbackend'</span></span><br><span class="line">html = requests.post(url,json={<span class="string">'name'</span>:<span class="string">'yunq'</span>,<span class="string">'age'</span>:<span class="number">24</span>}).content.decode()</span><br><span class="line">print(html)</span><br><span class="line"><span class="comment"># 如果你看到这一段文字，说明你已经成功访问了这个页面，并获取了POST方式的异步加载数据。你向服务器提交的两个参数，分别为name： yunq, age：24</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>参考<a href="http://exercise.kingname.info/exercise_ajax_1.html" target="_blank" rel="noopener">学习网站</a>，(<a href="#异步GET与POST请求">异步 GET 与 POST 请求</a>)</p>
</blockquote>
<h1 id="3-re-库"><a href="#3-re-库" class="headerlink" title="3. re 库"></a>3. re 库</h1><h2 id="3-1-基础用法"><a href="#3-1-基础用法" class="headerlink" title="3.1 基础用法"></a>3.1 基础用法</h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">re.findall(<span class="string">r''</span>,html,re.S)   <span class="comment">#返回一个列表，这是一个列表所以可以取第一个数据</span></span><br><span class="line">                            <span class="comment">#re.findall(r'',html,re.S)[0]</span></span><br><span class="line"></span><br><span class="line">re.search(<span class="string">r''</span>,html,re.S)    <span class="comment">#返回一个re.Match类型数据</span></span><br><span class="line">                            <span class="comment">#&lt;re.Match object; span=(214, 297), match='secret = \'{"code": "\\u884c\\u52a8\\u4ee3\\u53f7&gt;</span></span><br><span class="line"></span><br><span class="line">re.search(<span class="string">r'href="sf"&gt;(.*?)&lt;'</span>).group()</span><br><span class="line">                            <span class="comment">#返回一个字符串             #.*?是匹配到的内容</span></span><br><span class="line">                            <span class="comment">#group()返回的是''内的字符串内容:href="sf"&gt;(.*?)&lt;</span></span><br><span class="line">                            <span class="comment">#group(1)返回的是()中的字符串内容:.*?</span></span><br><span class="line">                            <span class="comment">#如果(.*?)有多个，则使用group(1),group(2)........</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="4-正则表达式"><a href="#4-正则表达式" class="headerlink" title="4. 正则表达式"></a>4. 正则表达式</h1><p><code>.*?</code></p>
<h1 id="5-Xpath–lxml-库"><a href="#5-Xpath–lxml-库" class="headerlink" title="5. Xpath–lxml 库"></a>5. Xpath–lxml 库</h1><ul>
<li>XPath 是一种查询语言，能从 XML\HTML 的树状结构中寻找节点</li>
</ul>
<h2 id="5-1-XPath-语法"><a href="#5-1-XPath-语法" class="headerlink" title="5.1 XPath 语法"></a>5.1 XPath 语法</h2><h3 id="5-1-1-XPath-语法解析"><a href="#5-1-1-XPath-语法解析" class="headerlink" title="5.1.1 XPath 语法解析"></a>5.1.1 XPath 语法解析</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">example_html</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"useful"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>我需要的信息1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>我需要的信息2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>我需要的信息3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"useless"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>垃圾1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>垃圾2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>info = selector.xpath('//div[@class="useful"]/ul/li/text()')</code><br>就可以提取出 class=”userful”中的三句话，返回一个列表</p>
<h3 id="5-1-2-基本框架"><a href="#5-1-2-基本框架" class="headerlink" title="5.1.2 基本框架"></a>5.1.2 基本框架</h3><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lxml.html</span><br><span class="line">selector = lxml.html.fromstring(<span class="string">'网页源代码'</span>)    <span class="comment">#网页源代码可用requests来获取</span></span><br><span class="line">info = selector.xpath(<span class="string">'一段XPath语句'</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="5-1-3-example"><a href="#5-1-3-example" class="headerlink" title="5.1.3 example"></a>5.1.3 example</h3><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lxml.html</span><br><span class="line"></span><br><span class="line">source = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;      &lt;title&gt;测试&lt;/title&gt;</span></span><br><span class="line"><span class="string">&nbsp;   &lt;/head&gt;</span></span><br><span class="line"><span class="string">&nbsp;   &lt;body&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;      &lt;div class="useful"&gt;</span></span><br><span class="line"><span class="string"> &lt;ul&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            &lt;li class="info"&gt;我需要的信息1&lt;/li&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            &lt;li class="info"&gt;我需要的信息2&lt;/li&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            &lt;li class="info"&gt;我需要的信息3&lt;/li&gt;</span></span><br><span class="line"><span class="string"> &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;     &lt;/div&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;     &lt;div class="useless"&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         &lt;ul&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           &lt;li class="info"&gt;垃圾1&lt;/li&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           &lt;li class="info"&gt;垃圾2&lt;/li&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&nbsp;&nbsp;&nbsp;&nbsp;     &lt;/div&gt;</span></span><br><span class="line"><span class="string">&nbsp;    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">selector = lxml.html.fromstring(source)</span><br><span class="line">info = selector.xpath(<span class="string">'//div[@class="useful"]/ul/li/text()'</span>)</span><br><span class="line">print(info)         <span class="comment">#['我需要的信息1', '我需要的信息2', '我需要的信息3']</span></span><br></pre></td></tr></tbody></table></figure>

<hr>

<ul>
<li>a.<strong>XPath 语句格式</strong><br><code>info = selector.xpath('一段XPath语句')</code>中’一段 XPath 语句’的格式<br>核心思想：XPath 就是写地址<br>获取文本：<code>//标签1[@属性1="属性值1"]/标签2[@属性2="属性值2"]/..../text()</code><br>获取属性值：<code>//标签1[@属性1="属性值1"]/标签2[@属性2="属性值2"]/..../@属性n</code><br>其中的<code>[@属性="属性值"]</code>不是必需的，其作用是帮助过滤相同的标签，无相同标签可省略</li>
<li>b.<strong>标签 1 的选取</strong><br>标签 1 可以直接从 html 这个最外层的标签开始，一层一层往下找，这个时候，XPath 语句是这样的：<br><code>/html/body/div[@class="useful"]/ul/li/text()</code><br>但是由于前面的’/html/body’是所有 HTML 通用的，而且没有属性，所以可不写，即带属性标签前的标签都可以省略</li>
<li>c.<strong>可以省略的属性</strong><br>1、本身标签没有属性<br>2、这个标签所有的属性值相同</li>
<li>d.<strong>XPath 的特殊情况</strong><br>1、以相同字符串开头<code>标签[starts-with(@属性,"开头字符串")]</code></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id="test-1"&gt;需要的内容1&lt;/div&gt;</span><br><span class="line">&lt;div id="test-2"&gt;需要的内容2&lt;/div&gt;</span><br><span class="line">&lt;div id="testfault"&gt;需要的内容3&lt;/div&gt;</span><br><span class="line">&lt;div id="useless"&gt;这是我不需要的内容&lt;/div&gt;</span><br><span class="line">content = selector.xpath(<span class="string">'//div[starts-with(@id,"test")]/text()'</span>)</span><br><span class="line">print(content)      <span class="comment">#['需要的内容1','需要的内容3','需要的内容2']</span></span><br></pre></td></tr></tbody></table></figure>

<p>2、属性值包含相同字符串<code>标签[contains(@属性,"相同字符串")]</code><br>3、对 XPath 返回的对象执行 XPath</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useful = selector.xpath(<span class="string">'//div[@class="useful"]'</span>)   <span class="comment">#这里返回一个列表</span></span><br><span class="line">info_list = useful[<span class="number">0</span>].xpath(<span class="string">'ul/li/text()'</span>)         <span class="comment">#useful[0]即为列表中第一个数据</span></span><br><span class="line">print(info_list)</span><br></pre></td></tr></tbody></table></figure>

<p>4、不同标签下的文字</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lxml.html</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head lang="en"&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;div id="test3"&gt;</span></span><br><span class="line"><span class="string">        我左青龙，</span></span><br><span class="line"><span class="string">        &lt;span id="tiger"&gt;</span></span><br><span class="line"><span class="string">        右白虎，</span></span><br><span class="line"><span class="string">            &lt;ul&gt;上朱雀，</span></span><br><span class="line"><span class="string">                &lt;li&gt;下玄武。&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        老牛在当中，</span></span><br><span class="line"><span class="string">        &lt;/span&gt;</span></span><br><span class="line"><span class="string">        龙头在胸口。</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment">#如果直接提取id="test3"</span></span><br><span class="line">selector = lxml.html.fromstring(html)</span><br><span class="line">content_1 = selector.xpath(<span class="string">'//div[@id="test3"]/text()'</span>)</span><br><span class="line">print(content_1)   <span class="comment">#['\n        我左青龙，\n        ', '\n        龙头在胸口。\n    ']</span></span><br><span class="line"><span class="comment">#只会提取到div标签中的文字信息，而不会自动提取子标签中的信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这时就需要用string(.)关键字了</span></span><br><span class="line">selector = lxml.html.fromstring(html)</span><br><span class="line">data = selector.xpath(<span class="string">'//div[@id="test3"]'</span>)[<span class="number">0</span>]</span><br><span class="line">info = data.xpath(<span class="string">'string(.)'</span>)</span><br><span class="line">print(info)     <span class="comment">#就可以提取出所有的文本信息了</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="5-2-XPath-通过-chrome-辅助构造"><a href="#5-2-XPath-通过-chrome-辅助构造" class="headerlink" title="5.2 XPath 通过 chrome 辅助构造"></a>5.2 XPath 通过 chrome 辅助构造</h2><p>在一行源码单击右键，选择“Copy”→“Copy XPath”命令<br>把结果粘贴下来，可以看到如下的 XPath 语句：<br><code>//*[@id="thread_list"]/li[2]/div/div[2]/div[1]/div[1]/a</code><br><em>其中方括号中的数字，表示这是第几个该标签，但需要注意，这里的数字是从 1 开始</em></p>
<h1 id="6-Beautiful-Soup4-库-BS4"><a href="#6-Beautiful-Soup4-库-BS4" class="headerlink" title="6. Beautiful Soup4 库(BS4)"></a>6. Beautiful Soup4 库(BS4)</h1><p><em>BS4 在某些方面比 XPath 易懂，但是不如 XPath 简洁，而且由于它是使用 Python 开发的，因此速度比 XPath 慢。</em><br>使用 Beautiful Soup4 提取 HTML 内容，一般要经过以下两步。</p>
<h2 id="6-1-bs4-处理步骤"><a href="#6-1-bs4-处理步骤" class="headerlink" title="6.1 bs4 处理步骤"></a>6.1 bs4 处理步骤</h2><ul>
<li>1)处理源代码生成 BeautifulSoup 对象。<br>解析源代码生成 BeautifulSoup 对象，使用以下代码：<br><code>soup = BeautifulSoup(网页源代码, '解析器')</code><br>解析器：<br>这里的“解析器”，可以使用 html.parser：<br><code>soup = BeautifulSoup(source, 'html.parser')</code><br>如果安装了 lxml，还可以使用 lxml：<br><code>soup = BeautifulSoup(source, 'lxml')</code></li>
<li>2)使用 find<em>all()或者 find()来查找内容。<br>`soup.find(class</em>=’属性值’)`<br><em>由于 HTML 中的 class 属性与 Python 的 class 关键字相同，因此为了不产生冲突，BS4 规定，如果遇到要查询 class 的情况，使用“class_”来代替</em></li>
</ul>
<h2 id="6-2-example"><a href="#6-2-example" class="headerlink" title="6.2 example"></a>6.2 <a href="http://exercise.kingname.info/exercise_bs_1.html" target="_blank" rel="noopener">example</a></h2><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = requests.get(<span class="string">'http://exercise.kingname.info/exercise_bs_1.html'</span>).content.decode()</span><br><span class="line"><span class="comment"># 1、解析源代码</span></span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment"># 2、查找内容</span></span><br><span class="line">info = soup.find(class_= <span class="string">'test'</span>)</span><br><span class="line">print(info.string)      <span class="comment">#我需要的信息2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先抓大，再抓小</span></span><br><span class="line">useful = soup.find(class_=<span class="string">'useful'</span>)</span><br><span class="line">all_content = useful.find_all(<span class="string">'li'</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> all_content:</span><br><span class="line">    print(li.string)        <span class="comment">#我需要的信息1</span></span><br><span class="line">                            <span class="comment">#我需要的信息2</span></span><br><span class="line">                            <span class="comment">#我需要的信息3</span></span><br><span class="line">    print(li)               <span class="comment">#&lt;li class="info"&gt;我需要的信息1&lt;/li&gt;</span></span><br><span class="line">                            <span class="comment">#&lt;li class="test"&gt;我需要的信息2&lt;/li&gt;</span></span><br><span class="line">                            <span class="comment">#&lt;li class="iamstrange"&gt;我需要的信息3&lt;/li&gt;</span></span><br><span class="line">    print(li[<span class="string">'class'</span>])      <span class="comment">#['info']</span></span><br><span class="line">                            <span class="comment">#['test']</span></span><br><span class="line">                            <span class="comment">#['iamstrange']</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>其他查找方法<br><strong>以‘我需要’为开头的信息</strong><br><code>content = soup.find_all(text = re.compile('我需要'))</code><br><strong>对属性值搜素使用正则,即对 iamstrang 属性值搜索</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">content = soup.find_all(class_=re.compile(<span class="string">'iam'</span>))[<span class="number">0</span>]</span><br><span class="line">print(content.string)       <span class="comment">#我需要的信息3</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="7-异步加载与请求头"><a href="#7-异步加载与请求头" class="headerlink" title="7. 异步加载与请求头"></a>7. 异步加载与请求头</h1><h2 id="7-1-异步加载"><a href="#7-1-异步加载" class="headerlink" title="7.1 异步加载"></a>7.1 异步加载</h2><p><em>异步加载：一个页面，点击后网址不变，页面改变</em></p>
<h3 id="7-1-1-AJAX-技术"><a href="#7-1-1-AJAX-技术" class="headerlink" title="7.1.1 AJAX 技术"></a>7.1.1 AJAX 技术</h3><ul>
<li>AJAX 是 Asynchronous JavaScript And XML 的首字母缩写，意为异步 JavaScript 与 XML</li>
<li>使用 AJAX 技术，可以在不刷新网页的情况下更新网页数据。使用 AJAX 技术的网页，一般会使用 HTML 编写网页的框架。</li>
<li>在打开网页的时候，首先加载的是这个框架。剩下的部分将会在框架加载完成以后再通过 JavaScript 从后台加载。</li>
</ul>
<h3 id="7-1-2-JSON"><a href="#7-1-2-JSON" class="headerlink" title="7.1.2 JSON"></a>7.1.2 JSON</h3><ul>
<li>JSON 的全称是 JavaScript Object Notation，是一种轻量级的数据交换格式。网络之间使用 HTTP 方式传递数据的时候，绝大多数情况下传递的都是字符串。</li>
<li>因此，当需要把 Python 里面的数据发送给网页或者其他编程语言的时候，可以先将 Python 的数据转化为 JSON 格式的字符串，然后将字符串传递给其他语言，其他语言再将 JSON 格式的字符串转换为它自己的数据格式</li>
<li><strong>列表\字典与字符串相互转化</strong></li>
<li><em>python 中字典 or 列表 与 json 格式字符串的相互转化</em></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = {</span><br><span class="line">    <span class="string">'name'</span> : <span class="string">'Connor'</span>,</span><br><span class="line">    <span class="string">'sex'</span> : <span class="string">'boy'</span>,</span><br><span class="line">    <span class="string">'age'</span> : <span class="number">26</span></span><br><span class="line">}</span><br><span class="line">print(data)     <span class="comment">#dict   #{'name': 'Connor', 'sex': 'boy', 'age': 26}</span></span><br><span class="line">data1=json.dumps(data)</span><br><span class="line">print(data1)    <span class="comment">#str    #{"name": "Connor", "sex": "boy", "age": 26}</span></span><br><span class="line">data2=json.loads(data1)</span><br><span class="line">print(data2)    <span class="comment">#dict   #{'name': 'Connor', 'sex': 'boy', 'age': 26}</span></span><br><span class="line"><span class="comment"># 如果加上indent=4参数</span></span><br><span class="line">data3 = json.dumps(data,indent=<span class="number">4</span>)</span><br><span class="line">print(data3)    <span class="comment">#str</span></span><br><span class="line"><span class="comment">#结果更加的美观易读</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">    "name": "Connor",</span></span><br><span class="line"><span class="string">    "sex": "boy",</span></span><br><span class="line"><span class="string">    "age": 26</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>str=json.dumps(dict)</strong></li>
<li><strong>dict=json.loads(str)</strong></li>
</ul>
<h3 id="7-1-3-异步-GET-与-POST-请求"><a href="#7-1-3-异步-GET-与-POST-请求" class="headerlink" title="7.1.3 异步 GET 与 POST 请求"></a>7.1.3 异步 GET 与 POST 请求</h3><ul>
<li>使用异步加载技术的网站，被加载的内容是不能在源代码中找到的。</li>
<li>为了解决这个问题，就需要使用 Google Chrome 浏览器的开发者模式。在网页上单击右键，选择“检查”命令，然后定位到“Network”选项卡</li>
<li>接下来需要刷新网页。在 Windows 下，按 F5 键或者单击地址栏左边的“刷新”按钮</li>
<li>单击“Network”选项卡下面出现的“ajax_1_backend”和“ajax_1_postbackend”，并定位到“Response”选项卡，可以看到这里出现了网页上面的内容</li>
<li>再选择“Headers”选项卡，可以看到这个请求使用 GET 方式，发送到<a href="http://exercise.kingname.info/ajax_1_backend" target="_blank" rel="noopener">http://exercise.kingname.info/ajax_1_backend</a></li>
<li>对于网页中的第 2 条内容，查看“Headers”选项卡，可以看到，这是使用 POST 方式向<a href="http://exercise.kingname.info/ajax_1_postbackend" target="_blank" rel="noopener">http://exercise.kingname.info/ajax_1_postbackend</a> 发送请求，并以 JSON 格式提交数据<blockquote>
<p>具体代码实现看<em>request</em>&nbsp;&nbsp;的<strong><a href="#进阶用法">进阶用法</a></strong></p>
</blockquote>
</li>
</ul>
<h3 id="7-1-4-特殊的异步加载"><a href="#7-1-4-特殊的异步加载" class="headerlink" title="7.1.4 特殊的异步加载"></a>7.1.4 特殊的异步加载</h3><ul>
<li><strong><a href="http://exercise.kingname.info/exercise_ajax_2.html" target="_blank" rel="noopener">练习页面</a></strong></li>
</ul>
<ul>
<li>伪装成异步加载的后端渲染,数据就在源代码里，但却不直接显示出来</li>
<li>源代码最下面的 JavaScript 代码，其中有一段：<br><code>{"code": "\u884c\u52a8\u4ee3\u53f7\uff1a\u5929\u738b\u76d6\u5730\u864e"}</code></li>
<li>使用 Python 去解析，发现可以得到网页上面的内容</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">html_json = <span class="string">'{"code": "\u884c\u52a8\u4ee3\u53f7\uff1a\u5929\u738b\u76d6\u5730\u864e"}'</span></span><br><span class="line">html_dic = json.loads(html_json)</span><br><span class="line">print(html_dic)      <span class="comment">#{'code': '行动代号：天王盖地虎'}</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>这种假的异步加载页面，其处理思路一般是使用正则表达式从页面中把数据提取出来，然后直接解析</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/exercise_ajax_2.html'</span></span><br><span class="line">html = requests.get(url).content.decode()</span><br><span class="line">code_json = re.search(<span class="string">"secret = '(.*?)'"</span>, html, re.S).group(<span class="number">1</span>)</span><br><span class="line">code_dict = json.loads(code_json)</span><br><span class="line">print(code_dict[<span class="string">'code'</span>])</span><br><span class="line"><span class="comment">#行动代号：天王盖地虎</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="7-1-5-多次请求的异步加载"><a href="#7-1-5-多次请求的异步加载" class="headerlink" title="7.1.5 多次请求的异步加载"></a>7.1.5 多次请求的异步加载</h3><ul>
<li><strong><a href="http://exercise.kingname.info/exercise_ajax_3.html" target="_blank" rel="noopener">练习页面</a></strong></li>
</ul>
<ul>
<li>还有一些网页，显示在页面上的内容要经过多次异步请求才能得到。</li>
<li>第 1 个 AJAX 请求返回的是第 2 个请求的参数，第 2 个请求的返回内容又是第 3 个请求的参数，只有得到了上一个请求里面的有用信息，才能发起下一个请求</li>
<li>在“Headers”选项卡查看这个 POST 请求的具体参数，在 body 里面发现两个奇怪的参数 secret1 和 secret2</li>
<li>尝试修改 secret1 和 secret2，发现 POST 请求无法得到想要的结果<br><strong>奇怪的参数</strong></li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name: "xx"</span><br><span class="line">age: 24</span><br><span class="line">secret1: "kingname is genius."</span><br><span class="line">secret2: "kingname"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>如果修改这两个参数</strong></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/ajax_3_postbackend'</span></span><br><span class="line">return_json_1 = requests.post(url,json={<span class="string">"name"</span>:<span class="string">"xx"</span>,</span><br><span class="line"><span class="string">"age"</span>:<span class="string">"24"</span>,<span class="string">"secret1"</span>:<span class="string">"123"</span>,<span class="string">"secret2"</span>:<span class="string">"456"</span>})</span><br><span class="line">return_json_2 = requests.post(url,json={<span class="string">"name"</span> :<span class="string">"xx"</span>,<span class="string">"age"</span>:<span class="number">23</span></span><br><span class="line">})</span><br><span class="line">print(json.loads(return_json_1.content.decode()))   <span class="comment">#{'success': False, 'reason': '参数错误'}</span></span><br><span class="line">print(json.loads(return_json_2.content.decode()))   <span class="comment">#{'success': False, 'reason': '参数不全'}</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>打开这个练习页的源代码，在源代码中可以找到 secret_2</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>exercise ajax load<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> secret_2 = <span class="string">"kingname"</span>;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/js/jquery-3.2.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/js/loaddata_3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>虽然在 POST 参数中，名字是 secret2，而源代码中的名字是 secret_2，不过从值可以看出这就是同一个参数</li>
<li>源代码里面没有 secret1，因此就要考虑这个参数是不是来自于另一个异步请求</li>
<li>继续在开发者工具中查看其他请求，可以成功找到 secret1,注意，它的名字变为了“code”，但是从值可以看出这就是 secret1</li>
</ul>
<ul>
<li><strong>不少网站也会使用这种改名字的方式来迷惑爬虫开发者</strong></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{<span class="attr">code</span>: <span class="string">"kingname is genius."</span>, <span class="attr">success</span>: <span class="literal">true</span>}</span><br><span class="line">code: <span class="string">"kingname is genius."</span></span><br><span class="line">success: <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>这一条请求就是一个不带任何参数的 GET 请求</li>
<li><em>对于这种多次请求才能得到数据的情况，解决办法就是逐一请求，得到返回结果以后再发起下一个请求。具体到这个例子中，那就是先从源代码里面获得 secret2，再通过 GET 请求得到 secret1，最后使用 secret1 和 secret2 来获取页面上显示的内容</em></li>
</ul>
<ul>
<li><strong>[爬取网站]<a href="http://exercise.kingname.info/exercise_ajax_3.html" target="_blank" rel="noopener">http://exercise.kingname.info/exercise_ajax_3.html</a>)</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/exercise_ajax_3.html'</span></span><br><span class="line">first_ajax_url = <span class="string">'http://exercise.kingname.info/ajax_3_backend'</span></span><br><span class="line">second_ajax_url = <span class="string">'http://exercise.kingname.info/ajax_3_postbackend'</span></span><br><span class="line"></span><br><span class="line">page_html = requests.get(url).content.decode()</span><br><span class="line">secret_2 = re.search(<span class="string">"secret_2 = '(.*?)';"</span>,page_html,re.S).group(<span class="number">1</span>)</span><br><span class="line">print(secret_2)           <span class="comment">#kingname</span></span><br><span class="line"></span><br><span class="line">ajax_1_json = requests.get(first_ajax_url).content.decode()</span><br><span class="line">print(ajax_1_json)        <span class="comment">#{"code": "kingname is genius.", "success": true}</span></span><br><span class="line">ajax_1_dict = json.loads(ajax_1_json)</span><br><span class="line">secret_1 = ajax_1_dict[<span class="string">'code'</span>]</span><br><span class="line">print(secret_1)           <span class="comment">#kingname is genius.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取了secret_1和secret_2后post请求second_ajax_url</span></span><br><span class="line"></span><br><span class="line">ajax_2_json = requests.post(second_ajax_url,json={</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'yq'</span>,<span class="string">'age'</span>:<span class="number">24</span>,<span class="string">'secret1'</span>:secret_1,<span class="string">'secret2'</span>:secret_2</span><br><span class="line">}).content.decode()</span><br><span class="line">print(ajax_2_json)          <span class="comment">#{"code": "\u884c\u52a8\u4ee3\u53f7\uff1a\u54ce\u54df\u4e0d\u9519\u54e6", "success": true}</span></span><br><span class="line"></span><br><span class="line">ajax_2_dict = json.loads(ajax_2_json)</span><br><span class="line">print(ajax_2_dict)          <span class="comment">#{'code': '行动代号：哎哟不错哦', 'success': True}</span></span><br><span class="line"></span><br><span class="line">code = ajax_2_dict[<span class="string">'code'</span>]</span><br><span class="line">print(code)                 <span class="comment">#行动代号：哎哟不错哦</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="7-1-6-基于异步加载的简单登录"><a href="#7-1-6-基于异步加载的简单登录" class="headerlink" title="7.1.6 基于异步加载的简单登录"></a>7.1.6 基于异步加载的简单登录</h3><ul>
<li><strong><a href="http://exercise.kingname.info/exercise_ajax_4.html" target="_blank" rel="noopener">练习页面</a></strong></li>
</ul>
<ul>
<li>网站的登录方式有很多种，其中有一种比较简单的方式，就是使用 AJAX 发送请求来进行登录</li>
<li>在<a href="http://exercise.kingname.info/exercise_ajax_4.html" target="_blank" rel="noopener">练习页面</a>中根据输入框中的提示，使用用户名“kingname”和密码“genius”进行登录,登录成功以后弹出提示框</li>
<li><strong>对于这种简单的登录功能，可以使用抓取异步加载网页的方式来进行处理</strong></li>
<li>在 Chrome 开发者工具中可以发现，当单击“登录”按钮时，网页向后台发送了一条请求<br><strong><code>{"code": "kingname is genius", "success": true}</code></strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/ajax_4_backend'</span></span><br><span class="line">code_json = requests.post(url,json={</span><br><span class="line">    <span class="string">'username'</span>:<span class="string">'kingname'</span>,<span class="string">'password'</span>:<span class="string">'genius'</span>}).content.decode()</span><br><span class="line">code__dict = json.loads(code_json)</span><br><span class="line">print(code__dict[<span class="string">'code'</span>])</span><br><span class="line"><span class="comment"># kingname is genius</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>这就是使用 POST 方式的最简单的 AJAX 请求。使用获取 POST 方式的 AJAX 请求的代码，就能成功获取到登录以后返回的内容</li>
</ul>
<h2 id="7-2-请求头"><a href="#7-2-请求头" class="headerlink" title="7.2 请求头"></a>7.2 请求头</h2><h3 id="7-2-1-请求头的作用"><a href="#7-2-1-请求头的作用" class="headerlink" title="7.2.1 请求头的作用"></a>7.2.1 请求头的作用</h3><ul>
<li>使用计算机网页版外卖网站的读者应该会发现这样一个现象：第一次登录外卖网页的时候会让你选择当前所在的商业圈，一旦选定好之后关闭浏览器再打开，网页就会自动定位到先前选择的商业圈</li>
<li>又比如，例如携程的网站，使用计算机浏览器打开的时候，页面看起来非常复杂多样</li>
<li>同一个网址，使用手机浏览器打开时，网址会自动发生改变，而且得到的页面竟然完全不同<br><strong>同一个网址，PC 端和手机端页面不同</strong></li>
</ul>
<ul>
<li>Headers 称为请求头，浏览器可以将一些信息通过 Headers 传递给服务器，服务器也可以将一些信息通过 Headers 传递给浏览器，电商网站常常应用的 Cookies 就是 Headers 里面的一个部分</li>
</ul>
<h3 id="7-2-2-伪造请求头"><a href="#7-2-2-伪造请求头" class="headerlink" title="7.2.2 伪造请求头"></a>7.2.2 伪造请求头</h3><ul>
<li>打开<a href="http://exercise.kingname.info/exercise_headers.html" target="_blank" rel="noopener">练习页</a>，使用 Chrome 的开发者工具监控这个页面的网页请求</li>
<li>页面看起来像是发起了一个普通的 GET 方式的异步请求给<a href="http://exercise.kingname.info/exercise_headers_backend" target="_blank" rel="noopener">http://exercise.kingname.info/exercise_headers_backend</a></li>
<li>使用 requests 尝试获取这个网址的返回信息,结果发现失败</li>
<li>使用浏览器访问网站的时候，网站可以看到一个名称为 Headers（请求头）的东西</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">headers = {</span><br><span class="line">            Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">            Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">            Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span></span><br><span class="line"><span class="comment">            anhao: kingname</span></span><br><span class="line"><span class="comment">            Content-Type: application/json; charset=utf-8</span></span><br><span class="line"><span class="comment">            Cookie: __cfduid=d513aff6c34f63c4c2971cdf1e19780051581303763</span></span><br><span class="line"><span class="comment">            Host: exercise.kingname.info</span></span><br><span class="line"><span class="comment">            Proxy-Connection: keep-alive</span></span><br><span class="line"><span class="comment">            Referer: http://exercise.kingname.info/exercise_headers.html</span></span><br><span class="line"><span class="comment">            User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36</span></span><br><span class="line"><span class="comment">            X-Requested-With: XMLHttpRequest</span></span><br><span class="line"><span class="comment">            }</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>为了解决这个问题，就需要给爬虫“换头”。把浏览器的头安装到爬虫的身上，这样网站就不知道谁是谁了</li>
<li>要换头，首先就需要知道浏览器的头是什么样的。因此需要在 Chrome 浏览器开发者工具的“Network”选项卡的 Request Headers 里面观察这一次请求的请求头</li>
<li>在 requests 里面，设置请求头的参数名称为“headers”，它的值是一个字典<br><strong>带有请求头的请求，使用 requests 的发送格式为：</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">html = requests.get(url, headers=字典).content.decode()</span><br><span class="line">html = requests.post(url, json=xxx, headers=字典).content.decode()</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>代码中的字典就对应了浏览器中的请求头</li>
<li>在爬虫里面创建一个字典，将 Chrome 的请求头的内容复制进去，并调整好格式，发起一个带有 Chrome 请求头的爬虫请求，可以发现请求获得成功</li>
<li>虽然对于某些网站，在请求头里面只需要设置 User-Agent 就可以正常访问了，但是为了保险起见，还是建议把所有项目都带上，这样可以让爬虫更“像”浏览器</li>
</ul>
<h2 id="7-3-模拟浏览器"><a href="#7-3-模拟浏览器" class="headerlink" title="7.3 模拟浏览器"></a>7.3 模拟浏览器</h2><ul>
<li><strong><a href="http://exercise.kingname.info/exercise_advanced_ajax.html" target="_blank" rel="noopener">练习页面</a></strong></li>
<li><em>问题：</em></li>
<li>有一些网站在发起 AJAX 请求的时候，会带上特殊的字符串用于身份验证。这种字符串称为 Token</li>
<li>打开练习页面，这个页面在发起 AJAX 请求的时候会在 Headers 中带上一个参数 ReqTime；在 POST 发送的数据中会有一个参数 sum</li>
<li>多次刷新页面，可以发现 ReqTime 和 sum 一直在变化</li>
<li>不难看出 ReqTime 是精确到毫秒的时间戳，即使使用 Python 生成了一个时间戳，也不能得到网页上面的内容</li>
</ul>
<h3 id="7-3-1-Selenium-介绍"><a href="#7-3-1-Selenium-介绍" class="headerlink" title="7.3.1 Selenium 介绍"></a>7.3.1 Selenium 介绍</h3><ul>
<li>虽然在网页的源代码中无法看到被异步加载的内容，但是在 Chrome 的开发者工具的“Elements”选项卡下却可以看到网页上的内容</li>
</ul>
<h3 id="7-3-2-selenium-安装"><a href="#7-3-2-selenium-安装" class="headerlink" title="7.3.2 selenium 安装"></a>7.3.2 selenium 安装</h3><ul>
<li>安装 selenium <code>pip install selenium</code></li>
<li>下载 ChromeDriver</li>
</ul>
<h3 id="7-3-3-selenium-的使用"><a href="#7-3-3-selenium-的使用" class="headerlink" title="7.3.3 selenium 的使用"></a>7.3.3 selenium 的使用</h3><h4 id="7-3-3-1-获取源代码"><a href="#7-3-3-1-获取源代码" class="headerlink" title="7.3.3.1 获取源代码"></a>7.3.3.1 获取源代码</h4><ul>
<li><strong>将 chromedriver 与代码放在同一个文件夹中以方便代码直接调用</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化selenium</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome(<span class="string">'./chromedriver'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>指定了 Selenium 使用 ChromeDriver 来操作 Chrome 解析网页，括号里的参数就是 ChromeDriver 可执行文件的地址</li>
</ul>
<ul>
<li>如果要使用 PhantomJS，只需要修改第 3 行代码即可：driver = webdriver.PhantomJS(‘./phantomjs’)，需要将 PhantomJS 的可执行文件与代码放在一起</li>
<li>需要特别提醒的是，如果 chromedriver 与代码不在一起，可以通过绝对路径来指定，例如：driver = webdriver.Chrome(‘/usr/bin/chromedriver’)</li>
<li>使用 Windows 的读者可在路径字符串左引号的左边加一个“r”符号，将代码写为：driver = webdriver.Chrome(r’C:\server\chromedriver.exe’)</li>
<li>初始化完成以后，就可以使用 Selenium 打开网页了。要打开一个网页只需要一行代码：<br><code>driver.get('http://exercise.kingname.info/exercise_advanced_ajax.html')</code></li>
<li>代码运行以后会自动打开一个 Chrome 窗口，并在窗口里面自动进入这个网址对应的页面。一旦被异步加载的内容已经出现在了这个自动打开的 Chrome 窗口中，那么此时使用下列代码：<br><code>html = driver.page_source</code></li>
<li>就能得到在 Chrome 开发者工具中出现的 HTML 代码<br><strong>综合：</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">r'C:\Program Files (x86)\Google\Chrome\Application\chromedriver'</span>)</span><br><span class="line">driver.get(<span class="string">'http://exercise.kingname.info/exercise_advanced_ajax.html'</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">html = driver.page_source</span><br><span class="line">print(html)</span><br><span class="line">input(<span class="string">'按任意键结束：'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>运行程序会出现以下界面</strong><br><img src="https://raw.githubusercontent.com/yq010105/Blog_images/master/img/selenium.png" alt="selenium" title="selenium"></p>
<h4 id="7-3-3-2-等待信息出现"><a href="#7-3-3-2-等待信息出现" class="headerlink" title="7.3.3.2 等待信息出现"></a>7.3.3.2 等待信息出现</h4><ul>
<li>设置了一个 5s 的延迟，这是由于 Selenium 并不会等待网页加载完成再执行后面的代码。它只是向 ChromeDriver 发送了一个命令，让 ChromeDriver 打开某个网页</li>
<li>至于网页要开多久，Selenium 并不关心。由于被异步加载的内容会延迟出现，因此需要等待它出现以后再开始抓取</li>
</ul>
<h4 id="7-3-3-3-在网页中获取元素"><a href="#7-3-3-3-在网页中获取元素" class="headerlink" title="7.3.3.3 在网页中获取元素"></a>7.3.3.3 在网页中获取元素</h4><p><em>在网页中寻找需要的内容，可以使用类似于 Beautiful Soup4 的语法：</em></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">element = driver.find_element_by_id(<span class="string">"passwd-id"</span>) <span class="comment">#如果有多个符合条件的，返回第1个</span></span><br><span class="line">element = driver.find_element_by_name(<span class="string">"passwd"</span>) <span class="comment">#如果有多个符合条件的，返回第1个</span></span><br><span class="line">element_list = driver.find_elements_by_id(<span class="string">"passwd-id"</span>) <span class="comment">#以列表形式返回所有的符合条件的element</span></span><br><span class="line">element_list = driver.find_elements_by_name(<span class="string">"passwd"</span>) <span class="comment">#以列表形式返回所有的符合条件的element</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>也可以使用 XPath</strong></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">element = driver.find_element_by_xpath(<span class="string">"//input[@id='passwd-id']"</span>)</span><br><span class="line"><span class="comment">#如果有多个符合条件的，返回第1个</span></span><br><span class="line">element = driver.find_elements_by_xpath(<span class="string">"//div[@id='passwd-id']"</span>)</span><br><span class="line"><span class="comment">#以列表形式返回所有的符合条件的element</span></span><br></pre></td></tr></tbody></table></figure>

<p><a href="http://exercise.kingname.info/exercise_advanced_ajax.html" target="_blank" rel="noopener">练习网站</a></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">r'C:\Program Files (x86)\Google\Chrome\Application\chromedriver'</span>)</span><br><span class="line">driver.get(<span class="string">'http://exercise.kingname.info/exercise_advanced_ajax.html'</span>)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">try</span> :</span><br><span class="line">    WebDriverWait(driver,<span class="number">30</span>).until(EC.text_to_be_present_in_element(By.CLASS_NAME,<span class="string">"content"</span>),<span class="string">'通关'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> _:</span><br><span class="line">    print(<span class="string">'网页加载太慢，爬'</span>)</span><br><span class="line"><span class="comment"># 但是也可能会爬，不知到原因</span></span><br><span class="line">element = driver.find_element_by_xpath(<span class="string">'//div[@class="content"]'</span>)</span><br><span class="line">print(<span class="string">f'异步加载的内容是：<span class="subst">{element.text}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 异步加载的内容是：通关成功，通关口令：这是最终数据。</span></span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></tbody></table></figure>

<h2 id="7-4-实例：乐视爬取视频评论"><a href="#7-4-实例：乐视爬取视频评论" class="headerlink" title="7.4 实例：乐视爬取视频评论"></a>7.4 实例：<a href="http://www.le.com" target="_blank" rel="noopener">乐视</a>爬取视频评论</h2><ul>
<li><p><em>1&gt;分析网站的异步加载请求</em></p>
</li>
<li><p><em>2&gt;使用 requests 发送请求</em></p><hr><p></p>
</li>
<li><p>通过使用 Chrome 的开发者工具分析页面的异步加载请求，可以发现评论所在的请求</p>
</li>
<li><p>可以使用 Python 来模拟这个请求，从而获取视频的评论信息</p>
</li>
<li><p>在请求的 URL 里面有两个参数：vid 和 pid,这两个参数在网页的源代码里面都可以找到</p>
<hr>
</li>
<li><p>爬虫首先访问视频页面，通过正则表达式获取 vid 和 pid，并将结果保存到“necessary_info”这个类属性对应的字典中</p>
</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 核心代码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_necessary_id</span><span class="params">(self)</span>:</span></span><br><span class="line">  source = self.get_source(self.url, self.HEADERS)</span><br><span class="line">  vid = re.search(<span class="string">'vid: (\d+)'</span>, source).group(<span class="number">1</span>)</span><br><span class="line">  pid = re.search(<span class="string">'pid: (\d+)'</span>, source).group(<span class="number">1</span>)</span><br><span class="line">  self.necessary_info[<span class="string">'xid'</span>] = vid</span><br><span class="line">  self.necessary_info[<span class="string">'pid'</span>] = pid</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>访问评论的接口，用 Python 发起请求，获得评论数据</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_comment</span><span class="params">(self)</span>:</span></span><br><span class="line">    url = self.COMMENT_URL.format(xid=self.necessary_info[<span class="string">'xid'</span>],</span><br><span class="line">                             pid=self.necessary_info[<span class="string">'pid'</span>])</span><br><span class="line">    source = self.get_source(url, self.HEADERS)</span><br><span class="line">    source_json = source[source.find(<span class="string">'{"'</span>): <span class="number">-1</span>]</span><br><span class="line">    comment_dict = json.loads(source_json)</span><br><span class="line">    comments = comment_dict[<span class="string">'data'</span>]</span><br><span class="line">    <span class="keyword">for</span> comment <span class="keyword">in</span> comments:</span><br><span class="line">        print(<span class="string">f'发帖人： <span class="subst">{comment[<span class="string">"user"</span>][<span class="string">"username"</span>]}</span>, 评论内容：<span class="subst">{comment[<span class="string">"content"</span>]}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>代码中，提前定义的 self.COMMENT_URL 和 self.HEADERS</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 综合</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LetvSpider</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    COMMENT_URL = <span class="string">'http://api-my.le.com/vcm/api/list?jsonp=jQuery19100358 \</span></span><br><span class="line"><span class="string">    8935956887496_1581419682085&amp;type=video&amp;rows=20&amp;page=1&amp;sort=&amp;cid=2&amp;sourc\</span></span><br><span class="line"><span class="string">    e=1&amp;xid=27576461&amp;pid=10022394&amp;ctype=cmt%2Cimg%2Cvote&amp;listType=1&amp;_=1581419682087'</span></span><br><span class="line"></span><br><span class="line">    HEADERS = {<span class="string">'Accept'</span>: <span class="string">'*/*'</span>,</span><br><span class="line">            <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">            <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7'</span>,</span><br><span class="line">            <span class="string">'Cookie'</span>: <span class="string">'tj_lc=d551d3996ae75055e97c1f22ac9aa002; tj_uuid=-_15814196222976075472; tj_env=1; ssoCookieSynced=1; language=zh-cn; sso_curr_country=CN; vjuids=-75eba524.17033f49d1f.0.d645e0a5d3aa1; vjlast=1581419634.1581419634.30; tj_v2c=-27576461_2'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'api-my.le.com'</span>,</span><br><span class="line">            <span class="string">'Proxy-Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>:<span class="string">'http://www.le.com/ptv/vplay/27576461.html'</span>,</span><br><span class="line">            <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36'</span></span><br><span class="line">             }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,url)</span>:</span></span><br><span class="line">        self.necessary_info = {}</span><br><span class="line">        self.url = url</span><br><span class="line">        self.get_necessary_id()</span><br><span class="line">        self.get_comment()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 得到request返回的html--str</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_source</span><span class="params">(self,url,headers)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> requests.get(url,headers).content.decode()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_necessary_id</span><span class="params">(self)</span>:</span></span><br><span class="line">        source = self.get_source(self.url,self.HEADERS) <span class="comment"># 得到html</span></span><br><span class="line">        vid = re.search(<span class="string">'vid: (\d+)'</span>,source).group(<span class="number">1</span>)   <span class="comment">#re到vid、pid</span></span><br><span class="line">        pid = re.search(<span class="string">'pid: (\d+)'</span>,source).group(<span class="number">1</span>)</span><br><span class="line">        self.necessary_info[<span class="string">'xid'</span>] = vid        <span class="comment">#传入vid、pid到字典</span></span><br><span class="line">        self.necessary_info[<span class="string">'pid'</span>] = pid</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_comment</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = self.COMMENT_URL.format(xid=self.necessary_info[<span class="string">'xid'</span>],</span><br><span class="line">        pid=self.necessary_info[<span class="string">'pid'</span>])     <span class="comment"># format格式化  url 评论list的request_url</span></span><br><span class="line">        source = self.get_source(url,self.HEADERS)  <span class="comment"># 调用get_source()</span></span><br><span class="line">        source_json = source[source.find(<span class="string">'{"'</span>): <span class="number">-1</span>] <span class="comment"># str切片</span></span><br><span class="line">        comment_dict = json.loads(source_json)  <span class="comment">#一个字典</span></span><br><span class="line">        comments = comment_dict[<span class="string">'data'</span>]</span><br><span class="line">        <span class="keyword">for</span> comment <span class="keyword">in</span> comments:</span><br><span class="line">            print(<span class="string">f'发帖人：<span class="subst">{comment[<span class="string">"user"</span>][<span class="string">"username"</span>]}</span>,评论内容:<span class="subst">{comment[<span class="string">"content"</span>]}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    spider = LetvSpider(<span class="string">'http://www.le.com/ptv/vplay/27576461.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">发帖人：福建乐迷,评论内容:好喜欢东华帝君</span></span><br><span class="line"><span class="string">发帖人：河北乐迷,评论内容:十</span></span><br><span class="line"><span class="string">发帖人：河北乐迷,评论内容:瑶光上神好漂亮。</span></span><br><span class="line"><span class="string">发帖人：河北乐迷,评论内容:太好看了。</span></span><br><span class="line"><span class="string">发帖人：河北乐迷,评论内容:真水无香。</span></span><br><span class="line"><span class="string">发帖人：河北乐迷,评论内容:喜欢白浅</span></span><br><span class="line"><span class="string">发帖人：天莫邪,评论内容:杨幂真不好看</span></span><br><span class="line"><span class="string">发帖人：呆萌小甜心,评论内容:爱幂幂</span></span><br><span class="line"><span class="string">发帖人：G_,评论内容:有谁是看了枕上书又来看十里桃花我浅浅的</span></span><br><span class="line"><span class="string">发帖人：黑名单,评论内容:我来啦</span></span><br><span class="line"><span class="string">发帖人：凉辰梦瑾空人心_702_210,评论内容:为啥只能隔乐视看了 好伤心�😭</span></span><br><span class="line"><span class="string">发帖人：上海乐迷,评论内容:产科医生</span></span><br><span class="line"><span class="string">发帖人：红_,评论内容:这个很好看</span></span><br><span class="line"><span class="string">发帖人：子璇,评论内容:墨渊霸气，白浅跟她在一起才不会受伤害</span></span><br><span class="line"><span class="string">发帖人：聂芳英,评论内容:为什么其他的APP上看不到</span></span><br><span class="line"><span class="string">发帖人：月色不错,评论内容:这个是玉帝还是王母</span></span><br><span class="line"><span class="string">发帖人：Myth橙子,评论内容:每个平台看一遍我是有多闲</span></span><br><span class="line"><span class="string">发帖人：上海乐迷,评论内容:怎么这么难找〈产科医生）的电视剧</span></span><br><span class="line"><span class="string">发帖人：上海乐迷,评论内容:我想看产科医生的电视剧</span></span><br><span class="line"><span class="string">发帖人：上海乐迷,评论内容:产科医生</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"网站名：{name}, 地址 {url}"</span>.format(name=<span class="string">"菜鸟教程"</span>, url=<span class="string">"www.runoob.com"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过字典设置参数</span></span><br><span class="line">site = {<span class="string">"name"</span>: <span class="string">"菜鸟教程"</span>, <span class="string">"url"</span>: <span class="string">"www.runoob.com"</span>}</span><br><span class="line">print(<span class="string">"网站名：{name}, 地址 {url}"</span>.format(**site))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过列表索引设置参数</span></span><br><span class="line">my_list = [<span class="string">'菜鸟教程'</span>, <span class="string">'www.runoob.com'</span>]</span><br><span class="line">print(<span class="string">"网站名：{0[0]}, 地址 {0[1]}"</span>.format(my_list))  <span class="comment"># "0" 是必须的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 网站名：菜鸟教程, 地址 www.runoob.com</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssignValue</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">my_value = AssignValue(<span class="number">6</span>)</span><br><span class="line">print(<span class="string">'value 为: {0.value}'</span>.format(my_value))  <span class="comment"># "0" 是可选的</span></span><br><span class="line"><span class="comment"># value 为: 6</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="8-模拟登录与验证码"><a href="#8-模拟登录与验证码" class="headerlink" title="8. 模拟登录与验证码"></a>8. 模拟登录与验证码</h1><ul>
<li>对于一个需要登录才能访问的网站，它的页面在登录前和登录后可能是不一样的</li>
<li>如果直接使用 requests 去获取源代码，只能得到登录以前的页面源代码</li>
</ul>
<h2 id="8-1-模拟登录"><a href="#8-1-模拟登录" class="headerlink" title="8.1 模拟登录"></a>8.1 模拟登录</h2><ul>
<li>1.使用 Selenium 操作浏览器登录和使用 Cookies 登录虽然简单粗暴，但是有效</li>
<li>2.使用模拟提交表单登录虽然较为麻烦，但可以实现自动化</li>
</ul>
<h3 id="8-1-1-使用-Selenium-模拟登录"><a href="#8-1-1-使用-Selenium-模拟登录" class="headerlink" title="8.1.1 使用 Selenium 模拟登录"></a>8.1.1 使用 Selenium 模拟登录</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">     使用Selenium来进行模拟登录，整个过程非常简单。流程如下。</span><br><span class="line">（1）初始化ChromeDriver。</span><br><span class="line">（2）打开知乎登录页面。</span><br><span class="line">（3）找到用户名的输入框，输入用户名。</span><br><span class="line">（4）找到密码输入框，输入用户名。</span><br><span class="line">（5）手动单击验证码。</span><br><span class="line">（6）按下Enter键。</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>程序首先打开知乎的登录页面，然后使用“find<em>element_by</em> name”分别找到输入账号和密码的两个输入框</li>
<li>这两个输入框的 name 属性值分别为“account”(我的是 username)和“password”</li>
<li>在 Selenium 中可以使用 send_keys()方法往输入框中输入字符串</li>
<li>在输入了密码以后，验证码框就会弹出来。知乎使用的验证码为点击倒立的文字，这种验证码不容易自动化处理，因此在这个地方让爬虫先暂停，手动点击倒立文字</li>
<li>爬虫中的 input()语句会阻塞程序，直到在控制台按下 Enter 键，爬虫才会继续运行</li>
</ul>
<h3 id="8-1-2-使用-Cookies-登录"><a href="#8-1-2-使用-Cookies-登录" class="headerlink" title="8.1.2 使用 Cookies 登录"></a>8.1.2 使用 Cookies 登录</h3><ul>
<li><em>Cookie 是用户使用浏览器访问网站的时候网站存放在浏览器中的一小段数据</em></li>
<li>Cookie 的复数形式 Cookies 用来表示各种各样的 Cookie。它们有些用来记录用户的状态信息；有些用来记录用户的操作行为；还有一些，具有现代网络最重要的功能：记录授权信息——用户是否登录以及用户登录哪个账号</li>
<li>为了不让用户每次访问网站都进行登录操作，浏览器会在用户第一次登录成功以后放一段加密的信息在 Cookies 中。下次用户访问，网站先检查 Cookies 有没有这个加密信息，如果有并且合法，那么就跳过登录操作，直接进入登录后的页面</li>
<li>通过已经登录的 Cookies，可以让爬虫绕过登录过程，直接进入登录以后的页面</li>
<li>在已经登录知乎的情况下，打开 Chrome 的开发者工具，定位到“Network”选项卡，然后刷新网页，在加载的内容中随便选择一项，然后看右侧的数据，从 Request Headers 中可以找到 Cookie</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookie: _zap=56180d87-245a-4b79-83e2-711f4629644e; d_c0="AMAY69ZKzRCPTh5KJj9edoIQ4_BiQS3iqwM=|1581434842"; _xsrf=jzLzeCfZignAw6qDdNqO85UOdCrRcB3C; Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49=1581485103,1581492629,1581492650,1581494278; capsion_ticket="2|1:0|10:1581494284|14:capsion_ticket|44:ZjQyY2FjMmZkZTJmNDJkNGI5NmYxMDNkMzc3MTVlNGI=|e2f4eb7e3652b2f1f3e439d7ff4275e4e15bdfbfbed8ce423dceded2da4235cf"; z_c0="2|1:0|10:1581494646|4:z_c0|92:Mi4xY2R0cUJRQUFBQUFBd0JqcjFrck5FQ1lBQUFCZ0FsVk5kdjh3WHdBMEczY0dBVm5MNUFmV1V4cmtja0p1Rm1kMGtn|560b73b3b5f052f6151d4a02e62f1f645f01ad7826d8c183d7152fb2fcf8456d"; Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49=1581494647; tst=r; KLBRSID=81978cf28cf03c58e07f705c156aa833|1581494650|1581494278</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>请注意这里一定是“Request Headers”，不要选成了“Response Headers”</strong></li>
</ul>
<ul>
<li>只要把这个 Request Headers 的内容通过 requests 提交，就能直接进入登录以后的知乎页面了</li>
<li>可以看到，使用 Cookie 来登录网页，不仅可以绕过登录步骤，还可以绕过网站的验证码</li>
<li>Session，是指一段会话。网站会把每一个会话的 ID（Session ID）保存在浏览器的 Cookies 中用来标识用户的身份</li>
<li>requests 的 Session 模块可以自动保存网站返回的一些信息</li>
<li>其实在前面章节中使用的 requests.get()，在底层还是会先创建一个 Session，然后用 Session 去访问</li>
<li>对于 HTTPS 的网站，在 requests 发送请求的时候需要带上 verify=False 这个参数，否则爬虫会报错</li>
<li>带上这个参数以后，爬虫依然会报一个警告，这是因为没有 HTTPS 的证书</li>
<li>不过这个警告不会影响爬虫的运行结果。对于有强迫症的读者，可以参考相关内容为 requests 设置证书，从而解除这个警告</li>
</ul>
<h3 id="8-1-3-模拟表单登录"><a href="#8-1-3-模拟表单登录" class="headerlink" title="8.1.3 模拟表单登录"></a>8.1.3 模拟表单登录</h3><p><strong><a href="http://exercise.kingname.info/exercise_login?next=%2Fexercise_login_success" target="_blank" rel="noopener">练习页面</a></strong></p>
<ul>
<li>这个登录页面多了一个“自动登录”复选框输入用户名 kingname，密码 genius，勾选“自动登录”复选框并单击“登录”按钮，可以看到登录成功后的页面</li>
<li>打开 Chrome 的开发者工具并监控登录过程</li>
<li>然而，仔细观察会发现登录请求的那个网址只会在“Network”选项卡中存在 1s，然后就消失了</li>
<li>Network”选项卡下面只剩下登录成功后的页面所发起的各种网络请求</li>
<li>这是因为表单登录成功以后会进行页面跳转，相当于开了一个新的网页，于是新的请求就会直接把旧的请求覆盖。为了避免这种情况，需要在 Chrome 的开发者工具的“Network”选项卡中勾选“Preserve log”复选框，再一次登录就可以看到登录过程</li>
<li>此时可以看到 Status Code 是 302，说明这里有一个网页跳转，也就证明了之前为什么登录以后看不到登录的请求</li>
<li><strong>使用 requests 的 Session 模块来模拟这个登录</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">login_url = <span class="string">'http://exercise.kingname.info/exercise_login'</span></span><br><span class="line">login_sucess_url = <span class="string">'http://exercise.kingname.info/exercise_login_success'</span></span><br><span class="line"></span><br><span class="line">data = {</span><br><span class="line">    <span class="string">'username'</span>:<span class="string">'kingname'</span>,</span><br><span class="line">    <span class="string">'password'</span>:<span class="string">'genius'</span>,</span><br><span class="line">    <span class="string">'remember'</span>:<span class="string">'Yes'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">before_login = session.get(login_sucess_url).text</span><br><span class="line">print(before_login)</span><br><span class="line">print(<span class="string">'============开始登陆=============='</span>)</span><br><span class="line">session.post(login_url,data=data).text</span><br><span class="line">after_login = session.get(login_sucess_url).text</span><br><span class="line">print(after_login)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>结果</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>exercise login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      label {</span><br><span class="line">        display: block;</span><br><span class="line">        width: 100px;</span><br><span class="line">        margin-left: auto;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">      }</span><br><span class="line">      body {</span><br><span class="line">        text-align: center;</span><br><span class="line">      }</span><br><span class="line"><span class="css">      <span class="selector-class">.content</span> {</span></span><br><span class="line">        margin-right: auto;</span><br><span class="line">        margin-left: auto;</span><br><span class="line">        height: 200px;</span><br><span class="line">      }</span><br><span class="line"><span class="css">      <span class="selector-class">.login</span> {</span></span><br><span class="line">        display: block;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">        margin-left: auto;</span><br><span class="line">        margin-top: 5px;</span><br><span class="line">      }</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/exercise_login"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">              <span class="attr">name</span>=<span class="string">"username"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">"form-control"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">placeholder</span>=<span class="string">"请输入:kingname"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>密 码 :<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">              <span class="attr">name</span>=<span class="string">"password"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">"password"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">"form-control"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">placeholder</span>=<span class="string">"请输入:genius"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"checkbox pull-right"</span></span></span><br><span class="line"><span class="tag">            &gt;</span>自动登录</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">"checkbox"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">name</span>=<span class="string">"rememberme"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"Yes"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">data-toggle</span>=<span class="string">"checkbox"</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"login"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/js/jquery-3.2.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">============开始登陆==============</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Login Success<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">      如果你看到这一行内容，说明你已经登录成功。<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/exercise_logout"</span></span></span><br><span class="line"><span class="tag">        &gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="8-2-验证码"><a href="#8-2-验证码" class="headerlink" title="8.2 验证码"></a>8.2 验证码</h2><h3 id="8-2-1-肉眼打码"><a href="#8-2-1-肉眼打码" class="headerlink" title="8.2.1 肉眼打码"></a>8.2.1 肉眼打码</h3><ul>
<li><p>对于一次登录就可以长时间使用的情况，只需要识别一次验证码即可</p>
</li>
<li><p>这种情况下，与其花时间开发一个自动识别验证码的程序，不如直接肉眼识别</p>
</li>
<li><p><strong>肉眼识别验证码有两种情况，借助浏览器与不借助浏览器</strong></p>
</li>
<li><p>1、借助浏览器<br>在模拟登录中讲到过 Cookies，通过 Cookies 能实现绕过登录，从而直接访问需要登录的网站。因此，对于需要输入验证码才能进行登录的网站，可以手动在浏览器登录网站，并通过 Chrome 获取 Cookies，然后使用 Cookies 来访问网站<br>这样就可以实现人工输入一次验证码，然后很长时间不再登录。</p>
</li>
<li><p>2、不借助浏览器<br>对于仅仅需要识别图片的验证码，可以使用这种方式——先把验证码下载到本地，然后肉眼去识别并手动输入给爬虫</p>
</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">手动输入验证码的一般流程如下:</span><br><span class="line">（1）爬虫访问登录页面</span><br><span class="line">（2）分析网页源代码，获取验证码地址</span><br><span class="line">（3）下载验证码到本地</span><br><span class="line">（4）打开验证码，人眼读取内容</span><br><span class="line">（5）构造POST的数据，填入验证码</span><br><span class="line">（6）POST提交</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><em>需要注意的是，其中的（2）、（3）、（4）、（5）、（6）步是一气呵成的，是在爬虫运行的时候做的。绝对不能先把爬虫程序关闭，肉眼识别验证码以后再重新运行</em></li>
</ul>
<p><strong><a href="http://exercise.kingname.info/exercise_captcha.html" target="_blank" rel="noopener">练习页面</a></strong></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> lxml.html</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://exercise.kingname.info/exercise_captcha.html'</span></span><br><span class="line">url_check = <span class="string">'http://exercise.kingname.info/exercise_captcha_check'</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">html = session.get(url).content</span><br><span class="line">selector = lxml.html.fromstring(html)</span><br><span class="line">captcha_url = selector.xpath(<span class="string">'//img/@src'</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">image = requests.get(<span class="string">'http://exercise.kingname.info/'</span>+captcha_url).content</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'captcha.png'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(image)</span><br><span class="line"></span><br><span class="line">captcha = input(<span class="string">'请查看图片，然后输入在这里：'</span>)</span><br><span class="line">after_check = session.post(url_check,data={<span class="string">'captcha'</span>:captcha})</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'请输入验证码后，网站返回：<span class="subst">{after_check.content.decode()}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>结果</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请查看图片，然后输入在这里：1595</span><br><span class="line">请输入验证码后，网站返回：看到这个页面，说明你的验证码输入正确</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://raw.githubusercontent.com/yq010105/Blog_images/master/img/captcha.png" alt="验证码"></p>
<h3 id="8-2-2-自动打码"><a href="#8-2-2-自动打码" class="headerlink" title="8.2.2 自动打码"></a>8.2.2 自动打码</h3><p>1、Python 图像识别</p>
<ul>
<li>对于验证码识别，Python 也有现成的库来使用</li>
<li>开源的 OCR 库 pytesseract 配合图像识别引擎 tesseract，可以用来将图片中的文字转换为文本</li>
<li>这种方式在爬虫中的应用并不多见。因为现在大部分的验证码都加上了干扰的纹理，已经很少能用单机版的图片识别方式来识别了。所以如果使用这种方式，只有两种情况：网站的验证码极其简单工整，使用大量的验证码来训练 tesseract<br><em>安装 tesseract</em><br>打开网页下载安装包：<a href="https://github.com/tesseract-ocr/tesseract/wiki/Downloads" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract/wiki/Downloads</a> ,在“3rd party Windows exe’s/ installer”下面可以找到.exe 安装包<br><em>安装 Python 库</em><br>pip install Pillow<br>pip install pytesseract<br>其中，Pillow 是 Python 中专门用来处理图像的第三方库，pytesseract 是专门用来操作 tesseract 的第三方库<br><em>tesseract 的使用</em></li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">          tesseract的使用非常简单。</span><br><span class="line">① 导入pytesseract和Pillow。</span><br><span class="line">② 打开图片。</span><br><span class="line">③ 识别。</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过以下代码来实现最简单的图片识别：</span></span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">image = Image.open(<span class="string">'验证码.png'</span>)</span><br><span class="line">code = pytesseract.image_to_string(image)</span><br><span class="line">print(code)</span><br></pre></td></tr></tbody></table></figure>

<p>2、打码网站<br>在线验证码识别的网站，简称打码网站。这些网站有一些是使用深度学习技术识别验证码，有一些是雇佣了很多人来人肉识别验证码<br>网站提供了接口来实现验证码识别服务。使用打码网站理论上可以识别任何使用输入方式来验证的验证码</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这种打码网站的流程一般是这样的。</span><br><span class="line">① 将验证码上传到网站服务器。</span><br><span class="line">② 网站服务器将验证码分发给打码工人。</span><br><span class="line">③ 打码工人肉眼识别验证码并上传结果。</span><br><span class="line">④ 网站将结果返回。</span><br></pre></td></tr></tbody></table></figure>

<p><em>使用在线打码</em><br>在百度或者谷歌上面搜索“验证码在线识别”，就可以找到很多提供在线打码的网站。但是由于一般这种打码网站是需要交费才能使用的，所以要注意财产安全</p>
<h2 id="8-3-案例-自动登录果壳网"><a href="#8-3-案例-自动登录果壳网" class="headerlink" title="8.3 案例-自动登录果壳网"></a>8.3 案例-自动登录果壳网</h2><p><a href="https://www.guokr.com" target="_blank" rel="noopener">目标网站</a><br>使用模拟登录与验证码识别的技术实现自动登录果壳网。 果壳网的登录界面有验证码，请使用人工或者在线打码的方式识别验证码，并让爬虫登录。登录以后可以正确显示“个人资料设置”界面的源代码</p>
<ul>
<li>涉及的知识点：</li>
<li>（1）爬虫识别验证码。</li>
<li>（2）爬虫模拟登录。<blockquote>
<p>来自<a href="https://github.com/kingname/SourceCodeOfBook/tree/master/%E7%AC%AC8%E7%AB%A0/program" target="_blank" rel="noopener">第八章</a>，需要使用再来深度学习</p>
</blockquote>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="tags"><a href="/tags/Python/"><i class="fa fa-tag"></i>Python</a><a href="/tags/Spider/"><i class="fa fa-tag"></i>Spider</a><a href="/tags/Note/"><i class="fa fa-tag"></i>Note</a></div><div class="post-nav"><a class="pre" href="/2020/02/08/learn-markdown/">Markdown基本知识</a><a class="next" href="/2020/02/04/q-python/">Python学习中遇到的问题</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Bilibili/" style="font-size: 15px;">Bilibili</a> <a href="/tags/Compete/" style="font-size: 15px;">Compete</a> <a href="/tags/Spider/" style="font-size: 15px;">Spider</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 15px;">单片机</a> <a href="/tags/Android-Studio/" style="font-size: 15px;">Android Studio</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Note/" style="font-size: 15px;">Note</a> <a href="/tags/Jsoup/" style="font-size: 15px;">Jsoup</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Server/" style="font-size: 15px;">Server</a> <a href="/tags/VB/" style="font-size: 15px;">VB</a> <a href="/tags/C/" style="font-size: 15px;">C#</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Questions/" style="font-size: 15px;">Questions</a> <a href="/tags/Api/" style="font-size: 15px;">Api</a> <a href="/tags/Source/" style="font-size: 15px;">Source</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Life/" style="font-size: 15px;">Life</a> <a href="/tags/Imagination/" style="font-size: 15px;">Imagination</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E5%8A%9B/">学习力</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%B3%E8%B1%A1%E5%8A%9B/">想象力</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%8A%9B/">技术力</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A0%E5%8A%9B/">无力</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%8A%9B/">资源力</a><span class="category-list-count">3</span></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Yun.Qi.</a> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> | Theme by<a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Maupassant</a><br/><span class="footer-birthday-text">Birthday</span><span class="footer-birthday-date">2020/02/04</span></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>