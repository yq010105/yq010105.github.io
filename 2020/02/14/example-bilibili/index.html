<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="summary"><title>用Python写的一些获取b站信息的小程序 | Yun.Qi</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.png"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">用Python写的一些获取b站信息的小程序</h1><a id="logo" href="/.">Yun.Qi</a><p class="summary">Note/Diary</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/diary/"><i class="fa fa-book"> Diary</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">用Python写的一些获取b站信息的小程序</h1><div class="post-meta">2020-02-14<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF%E5%8A%9B/">技术力</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-bilibili-用户基本信息-name，level，关注，粉丝-获取"><span class="toc-text">1. bilibili 用户基本信息(name，level，关注，粉丝)获取</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-bilibili-统计某视频评论区，并生成词云"><span class="toc-text">2. bilibili 统计某视频评论区，并生成词云</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-获取-bilibili-主页各个分区的视频封面和-av-号"><span class="toc-text">3. 获取 bilibili 主页各个分区的视频封面和 av 号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-主站上的实时人数"><span class="toc-text">4. 主站上的实时人数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-用户的粉丝数"><span class="toc-text">5. 用户的粉丝数</span></a></li></ol></div></div><div class="post-content"><a id="more"></a>

<p><strong>bilibili 提供的 api 接口(一串 json 字符)</strong><br><em>让基于 bilibili 的开发更简单</em><br><strong>我基于 python 写的几个使用 api 获取信息的例子</strong></p>
<!--more-->

<h1 id="1-bilibili-用户基本信息-name，level，关注，粉丝-获取"><a href="#1-bilibili-用户基本信息-name，level，关注，粉丝-获取" class="headerlink" title="1. bilibili 用户基本信息(name，level，关注，粉丝)获取"></a>1. bilibili 用户基本信息(name，level，关注，粉丝)获取</h1><p><code>https://api.bilibili.com/x/space/upstat?mid=UUID&amp;jsonp=jsonp</code><em>up 信息，名字，等级，视频总播放量，文章总浏览数</em><br><code>https://api.bilibili.com/x/relation/stat?vmid=UUID&amp;jsonp=jsonp</code><em>up 信息，关注数，黑名单，粉丝数</em></p>
<p><strong>简单的代码获取 up 信息</strong></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">mid = input(<span class="string">'输入要查询的up的uid：'</span>)</span><br><span class="line">url_space = <span class="string">'https://api.bilibili.com/x/space/acc/info?mid='</span> + mid</span><br><span class="line">url_relation = <span class="string">'https://api.bilibili.com/x/relation/stat?vmid='</span>+mid</span><br><span class="line">space = requests.get(url_space).content.decode()</span><br><span class="line">relation =requests.get(url_relation).content.decode()</span><br><span class="line"><span class="comment"># print(type(html))</span></span><br><span class="line">dict_space = json.loads(space)</span><br><span class="line">dict_rela = json.loads(relation)</span><br><span class="line"><span class="comment"># print(dict)</span></span><br><span class="line">up_name = dict_space[<span class="string">"data"</span>][<span class="string">"name"</span>]</span><br><span class="line">up_level = dict_space[<span class="string">'data'</span>][<span class="string">'level'</span>]</span><br><span class="line"></span><br><span class="line">up_following_num = dict_rela[<span class="string">'data'</span>][<span class="string">'following'</span>]</span><br><span class="line">up_follower_num = dict_rela[<span class="string">'data'</span>][<span class="string">'follower'</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">f'up名字是:<span class="subst">{up_name}</span>'</span>)</span><br><span class="line">print(<span class="string">f'up等级达到:<span class="subst">{up_level}</span>级'</span>)</span><br><span class="line"><span class="keyword">if</span> int(up_level)&gt;=<span class="number">5</span>:</span><br><span class="line">    print(<span class="string">'----哇是个大佬！！！----'</span>)</span><br><span class="line">print(<span class="string">f'up关注了<span class="subst">{up_following_num}</span>个人'</span>)</span><br><span class="line"><span class="keyword">if</span> int(up_following_num)&gt;=<span class="number">700</span>:</span><br><span class="line">    print(<span class="string">'----铁定是个dd！！！----'</span>)</span><br><span class="line">print(<span class="string">f'up有<span class="subst">{up_follower_num}</span>个粉丝'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>示例：</strong></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入要查询的up的uid：<span class="number">2</span></span><br><span class="line">up名字是:碧诗</span><br><span class="line">up等级达到:<span class="number">6</span>级</span><br><span class="line">----哇是个大佬！！！----</span><br><span class="line">up关注了<span class="number">191</span>个人</span><br><span class="line">up有<span class="number">804598</span>个粉丝</span><br></pre></td></tr></tbody></table></figure>

<h1 id="2-bilibili-统计某视频评论区，并生成词云"><a href="#2-bilibili-统计某视频评论区，并生成词云" class="headerlink" title="2. bilibili 统计某视频评论区，并生成词云"></a>2. bilibili 统计某视频评论区，并生成词云</h1><ul>
<li><strong>获取某视频评论区评论</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">av = input(<span class="string">'请输入视频的av号:'</span>)</span><br><span class="line">p_total = input(<span class="string">'请输入评论要几页:'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_urls</span><span class="params">()</span>:</span></span><br><span class="line">    urls = []</span><br><span class="line">    p = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> p &lt;= int(p_total):</span><br><span class="line">        url = <span class="string">'http://api.bilibili.com/x/v2/reply?jsonp=jsonp&amp;;pn='</span> + str(p) + <span class="string">'&amp;type=1&amp;oid='</span> + av</span><br><span class="line">        urls.append(url)</span><br><span class="line">        p += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_name_con</span><span class="params">(url)</span>:</span></span><br><span class="line">    html = requests.get(url).content.decode()</span><br><span class="line">    yh_names = re.findall(<span class="string">r'"uname":"(.*?)","sex":'</span>,html,re.S)</span><br><span class="line">    yh_contents = re.findall(<span class="string">r'"message":"(.*?)","plat"'</span>,html,re.S)</span><br><span class="line">    <span class="keyword">del</span> yh_contents[<span class="number">0</span>]</span><br><span class="line">    yh_contents2 = []</span><br><span class="line">    <span class="keyword">for</span> yh_content <span class="keyword">in</span> yh_contents:</span><br><span class="line">        yh_contents2.append(yh_content.replace(<span class="string">'\\n'</span>,<span class="string">' '</span>))</span><br><span class="line">    <span class="comment"># print(yh_contents2)</span></span><br><span class="line">    <span class="comment"># exit()</span></span><br><span class="line">    <span class="keyword">return</span> yh_names,yh_contents2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_names_cons</span><span class="params">()</span>:</span></span><br><span class="line">    pool = Pool(<span class="number">5</span>)</span><br><span class="line">    urls = get_urls()</span><br><span class="line">    namecons = pool.map(get_name_con,urls)</span><br><span class="line">    names = []</span><br><span class="line">    cons = []</span><br><span class="line">    <span class="keyword">for</span> namecon <span class="keyword">in</span> namecons:</span><br><span class="line">        name = namecon[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> name :</span><br><span class="line">            names.append(n)</span><br><span class="line">        con = namecon[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> con:</span><br><span class="line">            cons.append(c)</span><br><span class="line">    <span class="keyword">return</span> names,cons</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">()</span>:</span></span><br><span class="line">    tumple = get_names_cons()</span><br><span class="line">    namelst = tumple[<span class="number">0</span>]</span><br><span class="line">    conlst = tumple[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># print(len(conlst))</span></span><br><span class="line">    <span class="comment"># # print(type(namelst))</span></span><br><span class="line">    <span class="comment"># print(len(namelst))</span></span><br><span class="line">    <span class="comment"># exit()</span></span><br><span class="line">    <span class="keyword">if</span> len(namelst) != len(conlst):</span><br><span class="line">        tot = len(conlst)</span><br><span class="line">    g = <span class="number">0</span></span><br><span class="line">    main_path = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\txt'</span> <span class="comment">#修改路径-自定义</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(main_path):</span><br><span class="line">        os.makedirs(main_path)</span><br><span class="line"></span><br><span class="line">    dir1 = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\txt\\'</span> + <span class="string">'comment'</span>  + <span class="string">'.txt'</span>  <span class="comment"># 自定义文件名</span></span><br><span class="line">    <span class="keyword">with</span> open(dir1,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fb:</span><br><span class="line">        <span class="keyword">for</span> g <span class="keyword">in</span> range(tot):</span><br><span class="line">            <span class="comment"># fb.write(namelst[g])</span></span><br><span class="line">            <span class="comment"># fb.write('\t\t\t')</span></span><br><span class="line">            fb.write(conlst[g])</span><br><span class="line">            <span class="comment"># fb.write('\n')</span></span><br><span class="line">            g += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    save()</span><br><span class="line">    print(<span class="string">'----已完成----'</span>,end=<span class="string">'\t'</span>)</span><br><span class="line">    print(<span class="string">f'此视频已获得 <span class="subst">{p_total}</span> 页的评论'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>将生成的评论 txt 文件统计为词云</strong></li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"><span class="keyword">import</span> PIL .Image <span class="keyword">as</span> image</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans_cn</span><span class="params">(text)</span>:</span></span><br><span class="line">    word_list = jieba.cut(text)</span><br><span class="line">    result = <span class="string">' '</span>.join(word_list)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wc</span><span class="params">()</span>:</span></span><br><span class="line">    dir1 = <span class="string">'./txt/comment.txt'</span></span><br><span class="line">    <span class="keyword">with</span> open(dir1,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        text = f.read()</span><br><span class="line">        text = trans_cn(text)</span><br><span class="line">        WordCloud2 = WordCloud(</span><br><span class="line">            font_path = <span class="string">'C:\\windows\\Fonts\\simfang.ttf'</span></span><br><span class="line">        ).generate(text)</span><br><span class="line">        image_produce = WordCloud2.to_image()</span><br><span class="line">        image_produce.show()</span><br><span class="line">        WordCloud2.to_file(<span class="string">'./txt/comment.png'</span>)</span><br><span class="line"></span><br><span class="line">wc()</span><br></pre></td></tr></tbody></table></figure>

<p><strong>示例：av2</strong><br><img src="/img/bilibili/comment.png" alt="图片示例"></p>
<h1 id="3-获取-bilibili-主页各个分区的视频封面和-av-号"><a href="#3-获取-bilibili-主页各个分区的视频封面和-av-号" class="headerlink" title="3. 获取 bilibili 主页各个分区的视频封面和 av 号"></a>3. 获取 bilibili 主页各个分区的视频封面和 av 号</h1><p><code>https://www.bilibili.com/index/ding.json</code><em>首页 api，每刷新一次，信息就会改变一次</em><br><em>获取的视频信息也就不同，所以可以一直获取信息(理论上来说)</em><br><em>缺点是每次只能获取十张图片信息</em><br><em>用的是 wb 写入文件，所以即使文件有一样的也会被覆盖…</em></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">print(<span class="string">'-douga-teleplay-kichiku-dance-bangumi-fashion-life-ad-guochuang-movie-music-technology-game-ent--'</span>)</span><br><span class="line">fenqu = input(<span class="string">'请输入爬取分区:'</span>)</span><br><span class="line"><span class="keyword">if</span> fenqu == <span class="string">''</span>:</span><br><span class="line">    fenqu1 = <span class="string">'shuma'</span></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    fenqu1 = fenqu</span><br><span class="line"></span><br><span class="line">html = requests.get(</span><br><span class="line">    <span class="string">'https://www.bilibili.com/index/ding.json'</span>).content.decode()</span><br><span class="line"></span><br><span class="line">dict_html = json.loads(html)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">aids = []</span><br><span class="line">pics = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    aid = dict_html[fenqu][str(i)][<span class="string">'aid'</span>]</span><br><span class="line">    pic = dict_html[fenqu][str(i)][<span class="string">'pic'</span>]</span><br><span class="line">    aids.append(aid)</span><br><span class="line">    pics.append(pic)</span><br><span class="line"></span><br><span class="line">j = <span class="number">1</span></span><br><span class="line">h = j<span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    main_path = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\pic\\'</span>+fenqu1</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(main_path):</span><br><span class="line">        os.makedirs(main_path)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        piccc = requests.get(pics[h])</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">        print(<span class="string">'图片无法下载'</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">        print(<span class="string">'requests.exceptions.ReadTimeout'</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    dir = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\pic\\'</span> + \</span><br><span class="line">         fenqu1 + <span class="string">'\\'</span>  +<span class="string">'av'</span> + str(aids[h]) + <span class="string">'.jpg'</span></span><br><span class="line">    <span class="keyword">with</span> open(dir, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        print(<span class="string">f'正在爬取第<span class="subst">{j}</span>张图'</span>)</span><br><span class="line">        f.write(piccc.content)</span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line">    h += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'----完成图片爬取----'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><em>略微修改后</em><br><em>可能就是因为有重复的，会覆盖前面已下载的</em><br><em>爬个 5 次本该有 50 张，但才有 20 几张(dance 区)</em><br><em>可能 dance 区首页视频比较少吧，游戏区很多</em><br><strong>不管了反正这个爬虫也没什么用 hhh</strong></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pic</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> fenqu == <span class="string">''</span>:</span><br><span class="line">        fenqu1 = <span class="string">'shuma'</span></span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        fenqu1 = fenqu</span><br><span class="line"></span><br><span class="line">    html = requests.get(</span><br><span class="line">        <span class="string">'https://www.bilibili.com/index/ding.json'</span>).content.decode()</span><br><span class="line"></span><br><span class="line">    dict_html = json.loads(html)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    aids = []</span><br><span class="line">    pics = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        aid = dict_html[fenqu][str(i)][<span class="string">'aid'</span>]</span><br><span class="line">        pic = dict_html[fenqu][str(i)][<span class="string">'pic'</span>]</span><br><span class="line">        aids.append(aid)</span><br><span class="line">        pics.append(pic)</span><br><span class="line"></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    h = j<span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        main_path = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\pic\\'</span>+fenqu1</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(main_path):</span><br><span class="line">            os.makedirs(main_path)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            piccc = requests.get(pics[h])</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">            print(<span class="string">'图片无法下载'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            print(<span class="string">'requests.exceptions.ReadTimeout'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        dir = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\pic\\'</span> + \</span><br><span class="line">            fenqu1 + <span class="string">'\\'</span>  +<span class="string">'av'</span> + str(aids[h]) + <span class="string">'.jpg'</span></span><br><span class="line">        <span class="keyword">with</span> open(dir, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            print(<span class="string">f'正在爬取第<span class="subst">{j}</span>张图'</span>)</span><br><span class="line">            f.write(piccc.content)</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        h += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">to = int(input(<span class="string">'请输入你要爬多少次---一次最多十张：'</span>))</span><br><span class="line">print(<span class="string">'-douga-teleplay-kichiku-dance-bangumi-fashion-life-ad-guochuang-movie-music-technology-game-ent--'</span>)</span><br><span class="line">fenqu = input(<span class="string">'请输入爬取分区:'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(to):</span><br><span class="line">    get_pic()</span><br><span class="line">    print(<span class="string">f'----完成第<span class="subst">{i}</span>次图片爬取----'</span>)</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p><a href="https://github.com/yq010105/spider_learn/tree/master/bilibili/bilibili_api" target="_blank" rel="noopener">Github 源码链接</a></p>
</blockquote>
<h1 id="4-主站上的实时人数"><a href="#4-主站上的实时人数" class="headerlink" title="4. 主站上的实时人数"></a>4. 主站上的实时人数</h1><p>_所用 api 接口_<code>https://api.bilibili.com/x/web-interface/online?&amp;;jsonp=jsonp</code></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_num</span><span class="params">()</span>:</span></span><br><span class="line">    index = requests.get(</span><br><span class="line">    <span class="string">'https://api.bilibili.com/x/web-interface/online?&amp;;jsonp=jsonp'</span>).content.decode()</span><br><span class="line">    dict_index = json.loads(index)</span><br><span class="line">    all_count = dict_index[<span class="string">'data'</span>][<span class="string">'all_count'</span>]</span><br><span class="line">    web_online = dict_index[<span class="string">'data'</span>][<span class="string">'web_online'</span>]</span><br><span class="line">    play_online = dict_index[<span class="string">'data'</span>][<span class="string">'play_online'</span>]</span><br><span class="line"><span class="comment"># 应该是人数和实时在线人数</span></span><br><span class="line">    print(<span class="string">f'all_count:<span class="subst">{all_count}</span>'</span>)</span><br><span class="line">    print(<span class="string">f'web_online:<span class="subst">{web_online}</span>'</span>)</span><br><span class="line">    print(<span class="string">f'play_online:<span class="subst">{play_online}</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    print(<span class="string">f'第<span class="subst">{i+<span class="number">1</span>}</span>次计数'</span>)</span><br><span class="line">    print_num()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="5-用户的粉丝数"><a href="#5-用户的粉丝数" class="headerlink" title="5. 用户的粉丝数"></a>5. 用户的粉丝数</h1><p><em>只能获取一页，b 站最多是五页，多了就会有限制</em></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">uid = input(<span class="string">'请输入查找的up主的uid:'</span>)</span><br><span class="line">url = <span class="string">'https://api.bilibili.com/x/relation/followers?vmid='</span> + \</span><br><span class="line">    uid + <span class="string">'&amp;ps=0&amp;order=desc&amp;jsonp=jsonp'</span></span><br><span class="line"></span><br><span class="line">html = requests.get(url).content.decode()</span><br><span class="line">dic_html = json.loads(html)</span><br><span class="line"></span><br><span class="line">index_order = dic_html[<span class="string">'data'</span>][<span class="string">'list'</span>]</span><br><span class="line">mids, mtimes, unames, signs = [], [], [], []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> index_order:</span><br><span class="line">    mid = i[<span class="string">'mid'</span>]</span><br><span class="line">    mids.append(mid)</span><br><span class="line">    mtime = i[<span class="string">'mtime'</span>]</span><br><span class="line">    mmtime = time.asctime(time.localtime(mtime))</span><br><span class="line">    mtimes.append(mmtime)</span><br><span class="line">    uname = i[<span class="string">'uname'</span>]</span><br><span class="line">    unames.append(uname)</span><br><span class="line">    sign = i[<span class="string">'sign'</span>]</span><br><span class="line">    signs.append(sign)</span><br><span class="line"><span class="comment"># print(index_order)</span></span><br><span class="line"><span class="comment"># print(mids)</span></span><br><span class="line">headers = [<span class="string">'uid'</span>, <span class="string">'注册时间'</span>, <span class="string">'up姓名'</span>, <span class="string">'个性签名'</span>]</span><br><span class="line">rows = []</span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(mids)):</span><br><span class="line">    rows.append([mids[j], mtimes[j], unames[j], signs[j]])</span><br><span class="line"></span><br><span class="line">main_path = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\csv'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(main_path):</span><br><span class="line">    os.makedirs(main_path)</span><br><span class="line"></span><br><span class="line">dir = <span class="string">'E:\\learn\\py\\git\\spider\\spider_learn\\bilibili\\bilibili_api\\csv\\'</span> + \</span><br><span class="line">    <span class="string">'follers'</span> + <span class="string">'.csv'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(dir, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    fb = csv.writer(f)</span><br><span class="line">    fb.writerow(headers)</span><br><span class="line">    fb.writerows(rows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'----最多只显示一页的粉丝数，也就是50个----'</span>)</span><br><span class="line">print(<span class="string">f'共有<span class="subst">{len(mids)}</span>个粉丝'</span>)</span><br></pre></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="tags"><a href="/tags/Python/"><i class="fa fa-tag"></i>Python</a><a href="/tags/Bilibili/"><i class="fa fa-tag"></i>Bilibili</a></div><div class="post-nav"><a class="pre" href="/2020/02/15/tools-bilibili-api/">Bilibili提供的一些api</a><a class="next" href="/2020/02/13/python-wordcloud/">Python中WordCloud库的学习</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Bilibili/" style="font-size: 15px;">Bilibili</a> <a href="/tags/Compete/" style="font-size: 15px;">Compete</a> <a href="/tags/Spider/" style="font-size: 15px;">Spider</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Note/" style="font-size: 15px;">Note</a> <a href="/tags/Jsoup/" style="font-size: 15px;">Jsoup</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/C/" style="font-size: 15px;">C#</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Server/" style="font-size: 15px;">Server</a> <a href="/tags/Lua/" style="font-size: 15px;">Lua</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/VB/" style="font-size: 15px;">VB</a> <a href="/tags/Questions/" style="font-size: 15px;">Questions</a> <a href="/tags/Api/" style="font-size: 15px;">Api</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/Source/" style="font-size: 15px;">Source</a> <a href="/tags/Life/" style="font-size: 15px;">Life</a> <a href="/tags/Imagination/" style="font-size: 15px;">Imagination</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E5%8A%9B/">学习力</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%B3%E8%B1%A1%E5%8A%9B/">想象力</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%8A%9B/">技术力</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A0%E5%8A%9B/">无力</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B5%84%E6%BA%90%E5%8A%9B/">资源力</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/review-vb/">VB的作业和复习</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/26/css-project-study/">CSS学习中跟着老师做的几个项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/09/learn-ks/">快捷键——让学习更高效</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/08/note-cs/">C#-Note</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/04/python-threading/">Python多线程学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/03/yq-fund/">理财笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/02/python-pyqt/">Python中PyQt库的学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/python-schedule/">Python中schedule库的学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/python-pil/">Python中PIL库的学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/25/note-hcj/">前端开发的基础知识</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Yun.Qi.</a> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> | Theme by<a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> maupassant</a><br/><span class="footer-birthday-text">Birthday</span><span class="footer-birthday-date">2020/02/04</span></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>